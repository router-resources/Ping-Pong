{"version":3,"sources":["webpack://Openlogin/webpack/bootstrap","webpack://Openlogin/./src/constants.ts","webpack://Openlogin/external \"@babel/runtime/helpers/defineProperty\"","webpack://Openlogin/./src/utils.ts","webpack://Openlogin/external \"@toruslabs/openlogin-utils\"","webpack://Openlogin/external \"@toruslabs/openlogin-jrpc\"","webpack://Openlogin/./src/loglevel.ts","webpack://Openlogin/external \"@toruslabs/eccrypto\"","webpack://Openlogin/./src/Modal.ts","webpack://Openlogin/./src/OpenLogin.ts","webpack://Openlogin/./src/Provider.ts","webpack://Openlogin/./src/MemoryStore.ts","webpack://Openlogin/./src/OpenLoginStore.ts","webpack://Openlogin/external \"loglevel\"","webpack://Openlogin/external \"@toruslabs/http-helpers\"","webpack://Openlogin/external \"lodash.merge\"","webpack://Openlogin/external \"pump\"","webpack://Openlogin/./src/index.ts"],"names":["modalDOMElementID","storeKey","UX_MODE","POPUP","REDIRECT","OPENLOGIN_METHOD","LOGIN","LOGOUT","CHECK_3PC_SUPPORT","SET_PID_DATA","GET_DATA","ALLOWED_INTERACTIONS","JRPC","OPENLOGIN_NETWORK","MAINNET","TESTNET","CYAN","DEVELOPMENT","LOGIN_PROVIDER","GOOGLE","FACEBOOK","REDDIT","DISCORD","TWITCH","APPLE","LINE","GITHUB","KAKAO","LINKEDIN","TWITTER","WEIBO","WECHAT","EMAIL_PASSWORDLESS","WEBAUTHN","JWT","MFA_LEVELS","DEFAULT","OPTIONAL","MANDATORY","documentReady","Promise","resolve","document","readyState","addEventListener","htmlToElement","html","template","window","createElement","trimmedHtml","trim","innerHTML","content","firstChild","whitelistUrl","clientId","appKey","origin","appKeyBuf","Buffer","from","padStart","base64url","encode","getPublic","Error","sig","sign","keccak","update","digest","getHashQueryParams","replaceUrl","result","url","URL","location","href","searchParams","forEach","value","key","queryResult","get","queryParams","JSON","parse","safeatob","Object","keys","error","log","hash","substring","hashUrl","hashResult","hashParams","cleanUrl","pathname","history","replaceState","awaitReq","id","windowRef","reject","closedByHandler","closedMonitor","setInterval","closed","clearInterval","handler","ev","pid","data","removeEventListener","close","constructURL","params","baseURL","query","append","h","toString","storageAvailable","type","storageExists","storageLength","storage","length","x","setItem","removeItem","code","name","sessionStorageAvailable","localStorageAvailable","preloadIframe","openloginIframeHtml","crossOrigin","rel","relList","supports","head","appendChild","getPopupFeatures","dualScreenLeft","screenLeft","undefined","screenX","dualScreenTop","screenTop","screenY","w","width","innerWidth","documentElement","clientWidth","screen","height","innerHeight","clientHeight","systemZoom","left","Math","abs","top","features","loglevel","setLevel","getLogger","handleStream","handle","eventName","handlerWrapper","chunk","removeListener","on","Modal","constructor","modalUrl","init","initIFrame","setupStream","iframeElem","mux","setupMultiplex","PostMessageStream","target","targetWindow","contentWindow","targetOrigin","verifierStream","createStream","src","documentIFrameElem","getElementById","remove","info","modalZIndex","_hideModal","body","onload","initialized","_showModal","style","display","position","right","bottom","border","setAttribute","entries","map","k","v","join","_prompt","whiteLabel","loginConfig","cb","modalHandler","write","cleanup","OpenLogin","options","provider","Proxy","Provider","deleteProperty","_iframeUrl","network","modal","initState","no3PC","_startUrl","_popupUrl","redirectUrl","protocol","host","uxMode","replaceUrlOnRedirect","originData","privKey","state","store","OpenLoginStore","getInstance","iframeUrl","startUrl","popupUrl","support3PC","all","updateOriginData","_syncState","res","_check3PCSupport","_getData","filteredOriginData","stringify","whitelist","getWhitelist","getWhiteLabel","post","project_id","signed_urls","_","_fastLogin","defaultParams","loginParams","request","fastLogin","method","allowedInteractions","login","loginProvider","_selectedLogin","_modal","logout","logoutParams","_clientId","args","randomId","session","userData","timestamp","Date","now","_user","_userSig","_userData","_originData","_whiteLabelData","_loginConfig","includes","_jrpcRequest","_origin","_setPIDData","setTimeout","b64Params","jsonToBase64","_pid","_method","u","open","Array","isArray","push","_rpcRequest","getRpcPromiseCallback","newState","set","cancel","selectedLoginResponse","merge","_cleanup","encrypt","message","privateKey","exec","decrypt","ciphertext","getUserInfo","storeData","getStore","userInfo","email","profileImage","aggregateVerifier","verifier","verifierId","typeOfLogin","getEncodedLoginUrl","dataObject","SafeEventEmitter","rpcStream","JRPCConnection","createStreamMiddleware","pump","stream","rpcEngine","JRPCEngine","createIdRemapMiddleware","middleware","payload","callback","jsonrpc","MemoryStore","getItem","resetStore","instance","localStorage","toJSON","currStore"],"mappings":"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","file":"openlogin.cjs.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 15);\n","import { LoginConfig, OriginData, WhiteLabelData } from \"@toruslabs/openlogin-jrpc\";\nimport { ExtraLoginOptions } from \"@toruslabs/openlogin-utils\";\n\nexport const modalDOMElementID = \"openlogin-modal\";\n\nexport const storeKey = \"openlogin_store\";\n\nexport type PopupResponse<T> = {\n  pid: string;\n  data: T;\n};\n\nexport type Maybe<T> = Partial<T> | null | undefined;\n\nexport const UX_MODE = {\n  POPUP: \"popup\",\n  REDIRECT: \"redirect\",\n} as const;\n\nexport type UX_MODE_TYPE = typeof UX_MODE[keyof typeof UX_MODE];\n\nexport const OPENLOGIN_METHOD = {\n  LOGIN: \"openlogin_login\",\n  LOGOUT: \"openlogin_logout\",\n  CHECK_3PC_SUPPORT: \"openlogin_check_3PC_support\",\n  SET_PID_DATA: \"openlogin_set_pid_data\",\n  GET_DATA: \"openlogin_get_data\",\n} as const;\n\n// autocomplete workaround https://github.com/microsoft/TypeScript/issues/29729\nexport type CUSTOM_OPENLOGIN_METHOD_TYPE = string & { toString?: (radix?: number) => string };\n\nexport type OPENLOGIN_METHOD_TYPE = typeof OPENLOGIN_METHOD[keyof typeof OPENLOGIN_METHOD];\n\nexport const ALLOWED_INTERACTIONS = {\n  POPUP: \"popup\",\n  REDIRECT: \"redirect\",\n  JRPC: \"jrpc\",\n} as const;\n\nexport type ALLOWED_INTERACTIONS_TYPE = typeof ALLOWED_INTERACTIONS[keyof typeof ALLOWED_INTERACTIONS];\n\nexport type RequestParams = {\n  startUrl?: string;\n  popupUrl?: string;\n  method: OPENLOGIN_METHOD_TYPE | CUSTOM_OPENLOGIN_METHOD_TYPE;\n  params: Record<string, unknown>[];\n  allowedInteractions: ALLOWED_INTERACTIONS_TYPE[];\n};\n\nexport type BaseLogoutParams = {\n  /**\n   * You can get your clientId/projectId by registering your\n   * dapp on {@link \"https://developer.tor.us\"| developer dashbaord}\n   */\n  clientId: string;\n  /**\n   * Setting fastLogin to `true` will disable fast login for the user on this dapp.\n   *\n   * Defaults to false\n   * @defaultValue false\n   * @experimental\n   *\n   * @remarks\n   * Use this option with caution only when you are sure that you wish to disable fast login for the user on this dapp.\n   * In general you may not need to use this option.\n   */\n  fastLogin: boolean;\n};\n\nexport type BaseRedirectParams = {\n  /**\n   * redirectUrl is the dapp's url where user will be redirected after login.\n   *\n   * @remarks\n   * Register this url at {@link \"https://developer.tor.us\"| developer dashbaord}\n   * else initialization will give error.\n   */\n  redirectUrl?: string;\n  /**\n   * Any custom state you wish to pass along. This will be returned to you post redirect.\n   * Use this to store data that you want to be available to the dapp after login.\n   */\n  appState?: string;\n};\n\nexport const OPENLOGIN_NETWORK = {\n  MAINNET: \"mainnet\",\n  TESTNET: \"testnet\",\n  CYAN: \"cyan\",\n  DEVELOPMENT: \"development\",\n} as const;\n\nexport type OPENLOGIN_NETWORK_TYPE = typeof OPENLOGIN_NETWORK[keyof typeof OPENLOGIN_NETWORK];\n\nexport type OpenLoginOptions = {\n  /**\n   * You can get your clientId/projectId by registering your\n   * dapp on {@link \"https://developer.tor.us\"| developer dashbaord}\n   */\n  clientId: string;\n\n  /**\n   * network specifies the openlogin iframe url url to be used.\n   *\n   * - `'mainnet'`: https://app.openlogin.com will be used which is the production version.\n   * - `'cyan'`: https://cyan.openlogin.com will be used which is the production cyan version.\n   * - `'testnet'`: https://beta.openlogin.com will be used which is the beta version.\n   * - `'development'`: http://localhost:3000 will be used for development purpose.\n   */\n  network: OPENLOGIN_NETWORK_TYPE;\n\n  /**\n   * Setting no3PC forces openlogin to assume that third party cookies are blocked\n   * in the browser.\n   *\n   * @defaultValue false\n   * @remarks\n   * Only pass no3PC to `true` when you are sure that third party cookies are not\n   * supported. By default openlogin will self check third party cookies and proceed\n   * accordingly.\n   */\n  no3PC?: boolean;\n\n  /**\n   * redirectUrl is the dapp's url where user will be redirected after login.\n   *\n   * @remarks\n   * Register this url at {@link \"https://developer.tor.us\"| developer dashbaord}\n   * else initialization will give error.\n   */\n  redirectUrl?: string;\n\n  /**\n   * two uxModes are supported:-\n   * - `'POPUP'`: In this uxMode, a popup will be shown to user for login.\n   * - `'REDIRECT'`: In this uxMode, user will be redirected to a new window tab for login.\n   *\n   * @defaultValue `'POPUP'`\n   * @remarks\n   *\n   * Use of `'REDIRECT'` mode is recommended in browsers where popups might get blocked.\n   */\n  uxMode?: UX_MODE_TYPE;\n\n  /**\n   * replaceUrlOnRedirect removes the params from the redirected url after login\n   *\n   * @defaultValue true\n   */\n  replaceUrlOnRedirect?: boolean;\n\n  /**\n   * originData is used to verify the origin of dapp by iframe.\n   *\n   * @internal\n   * @remarks\n   * You don't have to pass originData explicitly if you have registered your dapp at\n   * {@link \"https://developer.tor.us\"| developer dashbaord}.\n   *\n   * originData contains a signature of dapp's origin url which is generated using\n   * project's secret.\n   */\n  originData?: OriginData;\n\n  /**\n   * loginConfig enables you to pass your own login verifiers configuration for various\n   * loginProviders.\n   *\n   * loginConfig is key value map where each key should be a valid loginProvider and value\n   * should be custom configuration for that loginProvider\n   *\n   * @remarks\n   * You can deploy your own verifiers from {@link \"https://developer.tor.us\"| developer dashbaord}\n   * to use here.\n   *\n   */\n  loginConfig?: LoginConfig;\n\n  /**\n   * _iframeUrl is for internal development use only and is used to override the\n   * `network` parameter.\n   * @internal\n   */\n  _iframeUrl?: string;\n  /**\n   * _startUrl is for internal development use only and is used specify authentication\n   * start url of iframe.\n   * @internal\n   */\n  _startUrl?: string;\n\n  /**\n   * _popupUrl is for internal development use only and is used specify url of popup window\n   * for popup uxMode.\n   * @internal\n   */\n  _popupUrl?: string;\n\n  /**\n   * options for whitelabling default openlogin modal.\n   */\n  whiteLabel?: WhiteLabelData;\n};\n\nexport const LOGIN_PROVIDER = {\n  GOOGLE: \"google\",\n  FACEBOOK: \"facebook\",\n  REDDIT: \"reddit\",\n  DISCORD: \"discord\",\n  TWITCH: \"twitch\",\n  APPLE: \"apple\",\n  LINE: \"line\",\n  GITHUB: \"github\",\n  KAKAO: \"kakao\",\n  LINKEDIN: \"linkedin\",\n  TWITTER: \"twitter\",\n  WEIBO: \"weibo\",\n  WECHAT: \"wechat\",\n  EMAIL_PASSWORDLESS: \"email_passwordless\",\n  WEBAUTHN: \"webauthn\",\n  JWT: \"jwt\",\n} as const;\n\n/**\n * {@label loginProviderType}\n */\nexport type LOGIN_PROVIDER_TYPE = typeof LOGIN_PROVIDER[keyof typeof LOGIN_PROVIDER];\n\n// autocomplete workaround https://github.com/microsoft/TypeScript/issues/29729\nexport type CUSTOM_LOGIN_PROVIDER_TYPE = string & { toString?: (radix?: number) => string };\n\nexport const MFA_LEVELS = {\n  DEFAULT: \"default\",\n  OPTIONAL: \"optional\",\n  MANDATORY: \"mandatory\",\n} as const;\n\nexport type MfaLevelType = typeof MFA_LEVELS[keyof typeof MFA_LEVELS];\n\nexport type LoginParams = BaseRedirectParams & {\n  /**\n   * loginProvider sets the oauth login method to be used.\n   * You can use any of the valid loginProvider from the supported list.\n   *\n   * If this param is not passed then it will show all the available\n   * login methods to user in a modal.\n   *\n   */\n  loginProvider?: LOGIN_PROVIDER_TYPE | CUSTOM_LOGIN_PROVIDER_TYPE;\n\n  /**\n   * Setting fastLogin to `true` will force user to login with webauthn if\n   * webauthn is available on device.\n   *\n   * Defaults to false\n   * @defaultValue false\n   * @experimental\n   *\n   * @remarks\n   * Use this option with caution only when you are sure about that user has\n   * enabled webauthn while registration, else don't use this option.\n   * Openlogin will itself take care of detecting and handling webauthn.\n   * In general you may not need to use this option.\n   */\n  fastLogin?: boolean;\n\n  /**\n   * Setting relogin to `true` will force user to relogin when login\n   * method is called even if user is already logged in. By default login\n   * method call skips login process if user is already logged in.\n   *\n   * * Defaults to false\n   * @defaultValue false\n   */\n  relogin?: boolean;\n\n  /**\n   * setting skipTKey to `true` will skip TKey onboarding for new users,\n   * whereas old users  will be presented with an option to skip tKey in UI\n   * if this option is enabled.\n   *\n   * Defaults to false\n   * @defaultValue false\n   */\n  skipTKey?: boolean;\n\n  /**\n   * You can set the `mfaLevel` to customize when mfa screen should be shown to user.\n   * It currently accepts 3 values:-\n   * - `'default'`: Setting mfa level to `default` will present mfa screen to user on every third login.\n   * - `'optional'`: Setting mfa level to `default` will present mfa screen to user on every login but user can skip it.\n   * - `'mandatory'`: Setting mfa level to `mandatory` will make it mandatory for user to setup mfa after login.\n   *\n   * Defaults to `default`\n   * @defaultValue `default`\n   */\n  mfaLevel?: MfaLevelType;\n\n  /**\n   * This option is for internal use only in torus wallet and has not effect\n   * on user's login on other dapps.\n   *\n   * Defaults to false\n   * @defaultValue false\n   * @internal\n   */\n  getWalletKey?: boolean;\n\n  /**\n   * extraLoginOptions can be used to pass standard oauth login options to\n   * loginProvider.\n   *\n   * For ex: you will have to pass `login_hint` as user's email and `domain`\n   * as your app domain in `extraLoginOptions` while using `email_passwordless`\n   * loginProvider\n   */\n  extraLoginOptions?: ExtraLoginOptions;\n};\n\nexport type OpenloginUserInfo = {\n  email: string;\n  name: string;\n  profileImage: string;\n  aggregateVerifier: string;\n  verifier: string;\n  verifierId: string;\n  typeOfLogin: LOGIN_PROVIDER_TYPE | CUSTOM_LOGIN_PROVIDER_TYPE;\n};\n","module.exports = require(\"@babel/runtime/helpers/defineProperty\");","import { getPublic, sign } from \"@toruslabs/eccrypto\";\nimport { base64url, keccak, safeatob } from \"@toruslabs/openlogin-utils\";\n\nimport { PopupResponse } from \"./constants\";\nimport log from \"./loglevel\";\n\nexport async function documentReady(): Promise<void> {\n  return new Promise<void>((resolve) => {\n    if (document.readyState !== \"loading\") {\n      resolve();\n    } else {\n      document.addEventListener(\"DOMContentLoaded\", () => {\n        resolve();\n      });\n    }\n  });\n}\n\nexport const htmlToElement = <T extends Element>(html: string): T => {\n  const template = window.document.createElement(\"template\");\n  const trimmedHtml = html.trim(); // Never return a text node of whitespace as the result\n  template.innerHTML = trimmedHtml;\n  return template.content.firstChild as T;\n};\n\nexport async function whitelistUrl(clientId: string, appKey: string, origin: string): Promise<string> {\n  const appKeyBuf = Buffer.from(appKey.padStart(64, \"0\"), \"hex\");\n  if (base64url.encode(getPublic(appKeyBuf)) !== clientId) throw new Error(\"appKey mismatch\");\n  const sig = await sign(appKeyBuf, Buffer.from(keccak(\"keccak256\").update(origin).digest(\"hex\"), \"hex\"));\n  return base64url.encode(sig);\n}\n\nexport function getHashQueryParams(replaceUrl = false): Record<string, string> {\n  const result = {};\n\n  const url = new URL(window.location.href);\n  url.searchParams.forEach((value, key) => {\n    if (key !== \"result\") {\n      result[key] = value;\n    }\n  });\n  const queryResult = url.searchParams.get(\"result\");\n  if (queryResult) {\n    try {\n      const queryParams = JSON.parse(safeatob(queryResult));\n      Object.keys(queryParams).forEach((key) => {\n        result[key] = queryParams[key];\n      });\n    } catch (error) {\n      log.error(error);\n    }\n  }\n\n  const hash = url.hash.substring(1);\n  const hashUrl = new URL(`${window.location.origin}/?${hash}`);\n  hashUrl.searchParams.forEach((value, key) => {\n    if (key !== \"result\") {\n      result[key] = value;\n    }\n  });\n  const hashResult = hashUrl.searchParams.get(\"result\");\n\n  if (hashResult) {\n    try {\n      const hashParams = JSON.parse(safeatob(hashResult));\n      Object.keys(hashParams).forEach((key) => {\n        result[key] = hashParams[key];\n      });\n    } catch (error) {\n      log.error(error);\n    }\n  }\n\n  if (replaceUrl) {\n    const cleanUrl = window.location.origin + window.location.pathname;\n    window.history.replaceState(null, \"\", cleanUrl);\n  }\n\n  return result;\n}\n\nexport function awaitReq<T>(id: string, windowRef: Window): Promise<T> {\n  return new Promise((resolve, reject) => {\n    if (!windowRef) reject(new Error(\"Unable to open window\"));\n    let closedByHandler = false;\n    const closedMonitor = setInterval(() => {\n      if (!closedByHandler && windowRef.closed) {\n        clearInterval(closedMonitor);\n        reject(new Error(\"user closed popup\"));\n      }\n    }, 500);\n    const handler = (ev: MessageEvent<PopupResponse<T & { error?: string }>>) => {\n      const { pid } = ev.data;\n      if (id !== pid) return;\n      window.removeEventListener(\"message\", handler);\n      closedByHandler = true;\n      clearInterval(closedMonitor);\n      windowRef.close();\n      if (ev.data.data && ev.data.data.error) {\n        reject(new Error(ev.data.data.error));\n      } else {\n        resolve(ev.data.data);\n      }\n    };\n\n    window.addEventListener(\"message\", handler);\n  });\n}\n\nexport function constructURL(params: { baseURL: string; query?: Record<string, unknown>; hash?: Record<string, unknown> }): string {\n  const { baseURL, query, hash } = params;\n\n  const url = new URL(baseURL);\n  if (query) {\n    Object.keys(query).forEach((key) => {\n      url.searchParams.append(key, query[key] as string);\n    });\n  }\n  if (hash) {\n    const h = new URL(constructURL({ baseURL, query: hash })).searchParams.toString();\n    url.hash = h;\n  }\n  return url.toString();\n}\n\nexport function storageAvailable(type: string): boolean {\n  let storageExists = false;\n  let storageLength = 0;\n  let storage: Storage;\n  try {\n    storage = window[type];\n    storageExists = true;\n    storageLength = storage.length;\n    const x = \"__storage_test__\";\n    storage.setItem(x, x);\n    storage.removeItem(x);\n    return true;\n  } catch (error) {\n    return (\n      error &&\n      // everything except Firefox\n      (error.code === 22 ||\n        // Firefox\n        error.code === 1014 ||\n        // test name field too, because code might not be present\n        // everything except Firefox\n        error.name === \"QuotaExceededErro r\" ||\n        // Firefox\n        error.name === \"NS_ERROR_DOM_QUOTA_REACHED\") &&\n      // acknowledge QuotaExceededError only if there's something already stored\n      storageExists &&\n      storageLength !== 0\n    );\n  }\n}\n\nexport const sessionStorageAvailable = storageAvailable(\"sessionStorage\");\nexport const localStorageAvailable = storageAvailable(\"localStorage\");\n\nexport function preloadIframe(url: string): void {\n  try {\n    if (typeof document === \"undefined\") return;\n    const openloginIframeHtml = document.createElement(\"link\");\n    openloginIframeHtml.href = url;\n    openloginIframeHtml.crossOrigin = \"anonymous\";\n    openloginIframeHtml.type = \"text/html\";\n    openloginIframeHtml.rel = \"prefetch\";\n    if (openloginIframeHtml.relList && openloginIframeHtml.relList.supports) {\n      if (openloginIframeHtml.relList.supports(\"prefetch\")) {\n        document.head.appendChild(openloginIframeHtml);\n      }\n    }\n  } catch (error) {\n    log.error(error);\n  }\n}\n\nexport function getPopupFeatures(): string {\n  // Fixes dual-screen position                             Most browsers      Firefox\n  const dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screenX;\n  const dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;\n\n  const w = 1200;\n  const h = 700;\n\n  const width = window.innerWidth\n    ? window.innerWidth\n    : document.documentElement.clientWidth\n    ? document.documentElement.clientWidth\n    : window.screen.width;\n\n  const height = window.innerHeight\n    ? window.innerHeight\n    : document.documentElement.clientHeight\n    ? document.documentElement.clientHeight\n    : window.screen.height;\n\n  const systemZoom = 1; // No reliable estimate\n\n  const left = Math.abs((width - w) / 2 / systemZoom + dualScreenLeft);\n  const top = Math.abs((height - h) / 2 / systemZoom + dualScreenTop);\n  const features = `titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${h / systemZoom},width=${w / systemZoom},top=${top},left=${left}`;\n  return features;\n}\n","module.exports = require(\"@toruslabs/openlogin-utils\");","module.exports = require(\"@toruslabs/openlogin-jrpc\");","import loglevel from \"loglevel\";\n\nloglevel.setLevel(\"error\");\n\nexport default loglevel.getLogger(\"openlogin\");\n","module.exports = require(\"@toruslabs/eccrypto\");","import { LoginConfig, ObjectMultiplex, PostMessageStream, setupMultiplex, Substream, WhiteLabelData } from \"@toruslabs/openlogin-jrpc\";\n\nimport { modalDOMElementID } from \"./constants\";\nimport log from \"./loglevel\";\nimport { documentReady, htmlToElement } from \"./utils\";\n\nexport const handleStream = (handle: Substream, eventName: string, handler: (chunk: unknown) => void): void => {\n  const handlerWrapper = (chunk: unknown) => {\n    handler(chunk);\n    handle.removeListener(eventName, handlerWrapper);\n  };\n  handle.on(eventName, handlerWrapper);\n};\n\nexport class Modal {\n  modalUrl: string;\n\n  iframeElem: HTMLIFrameElement;\n\n  initialized = false;\n\n  modalZIndex = 99999;\n\n  mux: ObjectMultiplex;\n\n  verifierStream: Substream;\n\n  constructor(modalUrl: string) {\n    this.modalUrl = modalUrl;\n  }\n\n  async init(): Promise<void> {\n    await this.initIFrame(this.modalUrl);\n    this.setupStream();\n  }\n\n  setupStream(): void {\n    if (this.iframeElem === null) throw new Error(\"iframe is null\");\n    this.mux = setupMultiplex(\n      new PostMessageStream({\n        name: \"modal_iframe_rpc\",\n        target: \"modal_rpc\",\n        targetWindow: this.iframeElem.contentWindow,\n        targetOrigin: new URL(this.modalUrl).origin,\n      })\n    );\n    this.verifierStream = this.mux.createStream(\"verifier\");\n  }\n\n  async initIFrame(src: string): Promise<void> {\n    await documentReady();\n    const documentIFrameElem = document.getElementById(modalDOMElementID) as HTMLIFrameElement;\n    if (documentIFrameElem) {\n      documentIFrameElem.remove();\n      log.info(\"already initialized, removing previous modal iframe\");\n    }\n    this.iframeElem = htmlToElement<HTMLIFrameElement>(\n      `<iframe\n        id=${modalDOMElementID}\n        class=\"torusIframe\"\n        src=\"${src}\"\n        style=\"display: none; position: fixed; top: 0; right: 0; width: 100%;\n        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex.toString()}\"\n      ></iframe>`\n    );\n    this._hideModal();\n    document.body.appendChild(this.iframeElem);\n    return new Promise<void>((resolve) => {\n      this.iframeElem.onload = () => {\n        this.initialized = true;\n        resolve();\n      };\n    });\n  }\n\n  _showModal(): void {\n    const style: Record<string, unknown> = {};\n    style.display = \"block\";\n    style.position = \"fixed\";\n    style.width = \"100%\";\n    style.height = \"100%\";\n    style.top = \"0px\";\n    style.right = \"0px\";\n    style.left = \"0px\";\n    style.bottom = \"0px\";\n    style.border = \"0\";\n    style[\"z-index\"] = this.modalZIndex;\n    this.iframeElem.setAttribute(\n      \"style\",\n      Object.entries(style)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(\";\")\n    );\n  }\n\n  _hideModal(): void {\n    const style: Record<string, unknown> = {};\n    style.display = \"none\";\n    style.position = \"fixed\";\n    style.width = \"100%\";\n    style.height = \"100%\";\n    style.top = \"0px\";\n    style.right = \"0px\";\n    style.left = \"0px\";\n    style.bottom = \"0px\";\n    style.border = \"0\";\n    style[\"z-index\"] = this.modalZIndex;\n    this.iframeElem.setAttribute(\n      \"style\",\n      Object.entries(style)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(\";\")\n    );\n  }\n\n  async _prompt(clientId: string, whiteLabel: WhiteLabelData, loginConfig: LoginConfig, cb: (chunk: unknown) => Promise<void>): Promise<void> {\n    this._showModal();\n    const modalHandler = (chunk) => {\n      this._hideModal();\n      cb(chunk);\n    };\n    handleStream(this.verifierStream, \"data\", modalHandler);\n    this.verifierStream.write({\n      name: \"prompt\",\n      clientId,\n      whiteLabel,\n      loginConfig,\n    });\n  }\n\n  async cleanup(): Promise<void> {\n    await documentReady();\n    const documentIFrameElem = document.getElementById(modalDOMElementID) as HTMLIFrameElement;\n    if (documentIFrameElem) {\n      documentIFrameElem.remove();\n      this.iframeElem = null;\n    }\n    this.initialized = false;\n  }\n}\n","import { decrypt, Ecies, encrypt, getPublic, sign } from \"@toruslabs/eccrypto\";\nimport { post } from \"@toruslabs/http-helpers\";\nimport { getRpcPromiseCallback, JRPCRequest, LoginConfig, OriginData, SessionInfo, WhiteLabelData } from \"@toruslabs/openlogin-jrpc\";\nimport { base64url, jsonToBase64, keccak, randomId } from \"@toruslabs/openlogin-utils\";\nimport merge from \"lodash.merge\";\n\nimport {\n  ALLOWED_INTERACTIONS,\n  BaseLogoutParams,\n  BaseRedirectParams,\n  CUSTOM_LOGIN_PROVIDER_TYPE,\n  LOGIN_PROVIDER_TYPE,\n  LoginParams,\n  OPENLOGIN_METHOD,\n  OPENLOGIN_NETWORK,\n  OPENLOGIN_NETWORK_TYPE,\n  OpenLoginOptions,\n  OpenloginUserInfo,\n  RequestParams,\n  UX_MODE,\n  UX_MODE_TYPE,\n} from \"./constants\";\nimport { Modal } from \"./Modal\";\nimport OpenLoginStore from \"./OpenLoginStore\";\nimport Provider from \"./Provider\";\nimport { awaitReq, constructURL, getHashQueryParams, getPopupFeatures, preloadIframe } from \"./utils\";\n\npreloadIframe(\"https://app.openlogin.com/sdk-modal\");\n\nexport type OpenLoginState = {\n  network: OPENLOGIN_NETWORK_TYPE;\n  privKey?: string;\n  walletKey?: string;\n  tKey?: string;\n  oAuthPrivateKey?: string;\n  support3PC?: boolean;\n  clientId: string;\n  iframeUrl: string;\n  redirectUrl: string;\n  startUrl: string;\n  popupUrl: string;\n  store: OpenLoginStore;\n  uxMode: UX_MODE_TYPE;\n  replaceUrlOnRedirect: boolean;\n  originData: OriginData;\n  whiteLabel: WhiteLabelData;\n  loginConfig: LoginConfig;\n};\n\nclass OpenLogin {\n  provider: Provider;\n\n  state: OpenLoginState;\n\n  modal: Modal;\n\n  constructor(options: OpenLoginOptions) {\n    this.provider = new Proxy(new Provider(), {\n      deleteProperty: () => true, // work around for web3\n    });\n    if (!options._iframeUrl) {\n      if (options.network === OPENLOGIN_NETWORK.MAINNET) {\n        options._iframeUrl = \"https://app.openlogin.com\";\n      } else if (options.network === OPENLOGIN_NETWORK.CYAN) {\n        options._iframeUrl = \"https://cyan.openlogin.com\";\n      } else if (options.network === OPENLOGIN_NETWORK.TESTNET) {\n        options._iframeUrl = \"https://beta.openlogin.com\";\n      } else if (options.network === OPENLOGIN_NETWORK.DEVELOPMENT) {\n        options._iframeUrl = \"http://localhost:3000\";\n      }\n    }\n    if (!options._iframeUrl) {\n      throw new Error(\"unspecified network and iframeUrl\");\n    }\n    this.modal = new Modal(`${options._iframeUrl}/sdk-modal`);\n    this.initState({\n      ...options,\n      no3PC: options.no3PC ?? false,\n      _iframeUrl: options._iframeUrl,\n      _startUrl: options._startUrl ?? `${options._iframeUrl}/start`,\n      _popupUrl: options._popupUrl ?? `${options._iframeUrl}/popup-window`,\n      redirectUrl: options.redirectUrl ?? `${window.location.protocol}//${window.location.host}${window.location.pathname}`,\n      uxMode: options.uxMode ?? UX_MODE.REDIRECT,\n      replaceUrlOnRedirect: options.replaceUrlOnRedirect ?? true,\n      originData: options.originData ?? { [window.location.origin]: \"\" },\n      whiteLabel: options.whiteLabel ?? {},\n      loginConfig: options.loginConfig ?? {},\n    });\n  }\n\n  get privKey(): string {\n    return this.state.privKey ? this.state.privKey.padStart(64, \"0\") : \"\";\n  }\n\n  initState(options: Required<OpenLoginOptions>): void {\n    this.state = {\n      uxMode: options.uxMode,\n      network: options.network,\n      store: OpenLoginStore.getInstance(),\n      iframeUrl: options._iframeUrl,\n      startUrl: options._startUrl,\n      popupUrl: options._popupUrl,\n      clientId: options.clientId,\n      redirectUrl: options.redirectUrl,\n      replaceUrlOnRedirect: options.replaceUrlOnRedirect,\n      originData: options.originData,\n      loginConfig: options.loginConfig,\n      support3PC: !options.no3PC,\n      whiteLabel: options.whiteLabel,\n    };\n  }\n\n  async init(): Promise<void> {\n    if (this.state.support3PC) {\n      await Promise.all([this.modal.init(), this.updateOriginData()]);\n      this.provider.init({ iframeElem: this.modal.iframeElem, iframeUrl: this.state.iframeUrl });\n      this._syncState(getHashQueryParams(this.state.replaceUrlOnRedirect));\n      const res = await this._check3PCSupport();\n      this.state.support3PC = !!res.support3PC;\n      if (this.state.support3PC) {\n        this._syncState(await this._getData());\n      }\n    } else {\n      await this.updateOriginData();\n      this._syncState(getHashQueryParams(this.state.replaceUrlOnRedirect));\n    }\n  }\n\n  async updateOriginData(): Promise<void> {\n    const filteredOriginData = JSON.parse(JSON.stringify(this.state.originData));\n    Object.keys(filteredOriginData).forEach((key) => {\n      if (filteredOriginData[key] === \"\") delete filteredOriginData[key];\n    });\n    const [whitelist, whiteLabel] = await Promise.all([this.getWhitelist(), this.getWhiteLabel()]);\n    this._syncState({ originData: { ...whitelist, ...filteredOriginData }, whiteLabel: { ...whiteLabel, ...this.state.whiteLabel } });\n  }\n\n  async getWhitelist(): Promise<OriginData> {\n    try {\n      const { clientId } = this.state;\n      if (!clientId) {\n        throw new Error(\"unspecified clientId\");\n      }\n      const res = await post<{ signed_urls: OriginData }>(\"https://api.developer.tor.us/whitelist\", {\n        project_id: this.state.clientId,\n      });\n      return res.signed_urls;\n    } catch (_) {\n      // fail silently\n      return {};\n    }\n  }\n\n  async getWhiteLabel(): Promise<WhiteLabelData> {\n    try {\n      const { clientId } = this.state;\n      if (!clientId) {\n        throw new Error(\"unspecified clientId\");\n      }\n      const res = await post<{ whiteLabel: WhiteLabelData }>(\"https://api.developer.tor.us/whitelabel\", {\n        project_id: this.state.clientId,\n      });\n      return res.whiteLabel;\n    } catch (_) {\n      // fail silently\n      return {};\n    }\n  }\n\n  async _fastLogin(params: Partial<BaseRedirectParams>): Promise<{ privKey: string }> {\n    const defaultParams: BaseRedirectParams = {\n      redirectUrl: this.state.redirectUrl,\n    };\n\n    const loginParams: BaseRedirectParams = {\n      ...defaultParams,\n      ...params,\n    };\n\n    const res = await this.request<{ privKey: string }>({\n      params: [{ ...loginParams, fastLogin: true }],\n      method: OPENLOGIN_METHOD.LOGIN,\n      startUrl: this.state.startUrl,\n      popupUrl: this.state.popupUrl,\n      allowedInteractions: [ALLOWED_INTERACTIONS.POPUP, ALLOWED_INTERACTIONS.REDIRECT],\n    });\n\n    this.state.privKey = res.privKey;\n    return res;\n  }\n\n  async login(params?: LoginParams & Partial<BaseRedirectParams>): Promise<{ privKey: string }> {\n    if (params?.loginProvider) {\n      return this._selectedLogin(params);\n    }\n    return this._modal(params);\n  }\n\n  async _selectedLogin(params: LoginParams & Partial<BaseRedirectParams>): Promise<{ privKey: string }> {\n    const defaultParams: BaseRedirectParams = {\n      redirectUrl: this.state.redirectUrl,\n    };\n\n    const loginParams: LoginParams = {\n      loginProvider: params.loginProvider,\n      ...defaultParams,\n      ...params,\n    };\n\n    // fast login flow\n    // if (this.state.store.get(\"touchIDPreference\") === \"enabled\" && !loginParams.extraLoginOptions?.login_hint) {\n    //   return this._fastLogin(loginParams);\n    // }\n\n    const res = await this.request<{ privKey: string; store?: Record<string, string> }>({\n      method: OPENLOGIN_METHOD.LOGIN,\n      allowedInteractions: [UX_MODE.REDIRECT, UX_MODE.POPUP],\n      startUrl: this.state.startUrl,\n      popupUrl: this.state.popupUrl,\n      params: [loginParams],\n    });\n    this.state.privKey = res.privKey;\n    if (res.store) {\n      this._syncState(res);\n    } else if (this.state.privKey && this.state.support3PC) {\n      this._syncState(await this._getData());\n    }\n    return { privKey: this.privKey };\n  }\n\n  async logout(logoutParams: Partial<BaseLogoutParams> & Partial<BaseRedirectParams> = {}): Promise<void> {\n    const params: Record<string, unknown> = {};\n    // defaults\n    params.redirectUrl = this.state.redirectUrl;\n    params._clientId = this.state.clientId;\n\n    if (logoutParams.clientId) {\n      params._clientId = logoutParams.clientId;\n    }\n    if (logoutParams.fastLogin !== undefined) {\n      params.fastLogin = logoutParams.fastLogin;\n    }\n    if (logoutParams.redirectUrl !== undefined) {\n      params.redirectUrl = logoutParams.redirectUrl;\n    }\n\n    const res = await this.request<void>({\n      method: OPENLOGIN_METHOD.LOGOUT,\n      params: [params],\n      startUrl: this.state.startUrl,\n      popupUrl: this.state.popupUrl,\n      allowedInteractions: [ALLOWED_INTERACTIONS.JRPC, ALLOWED_INTERACTIONS.POPUP, ALLOWED_INTERACTIONS.REDIRECT],\n    });\n\n    this.state.privKey = \"\";\n    // if (!params.fastLogin) this.state.store.set(\"touchIDPreference\", \"disabled\");\n    return res;\n  }\n\n  async request<T>(args: RequestParams): Promise<T> {\n    const pid = randomId();\n    let { params } = args;\n\n    // Note: _origin is added later in postMessageStream for jrpc requests\n    // do not add it here since its used for checking postMessage constraints\n    const session: Partial<SessionInfo> = {};\n    if (params.length !== 1) throw new Error(\"request params array should have only one element\");\n    const { startUrl, popupUrl, method, allowedInteractions } = args;\n    if (allowedInteractions.length === 0) throw new Error(\"no allowed interactions\");\n\n    if (this.state.clientId) {\n      session._clientId = this.state.clientId;\n    }\n\n    if (this.privKey) {\n      const userData = {\n        clientId: session._clientId,\n        timestamp: Date.now().toString(),\n      };\n      const sig = await sign(\n        Buffer.from(this.privKey, \"hex\"),\n        Buffer.from(keccak(\"keccak256\").update(JSON.stringify(userData)).digest(\"hex\"), \"hex\")\n      );\n      session._user = getPublic(Buffer.from(this.privKey, \"hex\")).toString(\"hex\");\n      session._userSig = base64url.encode(sig);\n      session._userData = userData;\n    }\n\n    session._originData = this.state.originData;\n    session._whiteLabelData = this.state.whiteLabel;\n    session._loginConfig = this.state.loginConfig;\n\n    // add in session data (allow overrides)\n    params = [{ ...session, ...params[0] }];\n\n    // use JRPC where possible\n\n    if (this.state.support3PC && allowedInteractions.includes(ALLOWED_INTERACTIONS.JRPC)) {\n      return this._jrpcRequest<Record<string, unknown>[], T>({ method, params });\n    }\n\n    // set origin\n    params[0]._origin = new URL((params[0].redirectUrl as string) ?? this.state.redirectUrl).origin;\n\n    // preset params\n    if (this.state.support3PC) {\n      // set params first if 3PC supported\n      await this._setPIDData(pid, params);\n      // eslint-disable-next-line require-atomic-updates\n      params = [{}];\n    }\n\n    if (!startUrl || !popupUrl) {\n      throw new Error(\"no url for redirect / popup flow\");\n    }\n\n    // method and pid are always in URL hash params\n    // convert params from JSON to base64\n\n    if (this.state.uxMode === UX_MODE.REDIRECT) {\n      // if redirects preferred, check for redirect flows first, then check for popup flow\n\n      if (allowedInteractions.includes(ALLOWED_INTERACTIONS.REDIRECT)) {\n        // give time for synchronous methods to complete before redirect\n        setTimeout(() => {\n          window.location.href = constructURL({\n            baseURL: startUrl,\n            hash: { b64Params: jsonToBase64(params[0]), _pid: pid, _method: method },\n          });\n        }, 50);\n        return {} as T;\n      }\n\n      if (allowedInteractions.includes(ALLOWED_INTERACTIONS.POPUP)) {\n        const u = new URL(\n          constructURL({\n            baseURL: popupUrl,\n            hash: { b64Params: jsonToBase64(params[0]), _pid: pid, _method: method },\n          })\n        );\n        const windowRef = window.open(u.toString(), \"_blank\", getPopupFeatures());\n        return awaitReq<T>(pid, windowRef);\n      }\n    } else {\n      // if popups preferred, check for popup flows first, then check for redirect flow\n\n      if (allowedInteractions.includes(ALLOWED_INTERACTIONS.POPUP)) {\n        const u = new URL(\n          constructURL({\n            baseURL: popupUrl,\n            hash: { b64Params: jsonToBase64(params[0]), _pid: pid, _method: method },\n          })\n        );\n        const windowRef = window.open(u.toString(), \"_blank\", getPopupFeatures());\n        return awaitReq<T>(pid, windowRef);\n      }\n\n      if (allowedInteractions.includes(ALLOWED_INTERACTIONS.REDIRECT)) {\n        // give time for synchronous methods to complete before redirect\n        setTimeout(() => {\n          window.location.href = constructURL({\n            baseURL: startUrl,\n            hash: { b64Params: jsonToBase64(params[0]), _pid: pid, _method: method },\n          });\n        }, 50);\n        return null;\n      }\n    }\n\n    throw new Error(\"no matching allowed interactions\");\n  }\n\n  async _jrpcRequest<T, U>(args: JRPCRequest<T>): Promise<U> {\n    // await this.initialized;\n    if (!args || typeof args !== \"object\" || Array.isArray(args)) {\n      throw new Error(\"invalid request args\");\n    }\n\n    const { method, params } = args;\n\n    if (typeof method !== \"string\" || method.length === 0) {\n      throw new Error(\"invalid request method\");\n    }\n\n    if (params === undefined || !Array.isArray(params)) {\n      throw new Error(\"invalid request params\");\n    }\n\n    if (params.length === 0) {\n      params.push({});\n    }\n\n    return new Promise<U>((resolve, reject) => {\n      this.provider._rpcRequest({ method, params }, getRpcPromiseCallback(resolve, reject));\n    });\n  }\n\n  async _check3PCSupport(): Promise<Record<string, boolean>> {\n    return this._jrpcRequest<Record<string, unknown>[], Record<string, boolean>>({\n      method: OPENLOGIN_METHOD.CHECK_3PC_SUPPORT,\n      params: [{ _originData: this.state.originData }],\n    });\n  }\n\n  async _setPIDData(pid: string, data: Record<string, unknown>[]): Promise<void> {\n    await this.request({\n      allowedInteractions: [ALLOWED_INTERACTIONS.JRPC],\n      method: OPENLOGIN_METHOD.SET_PID_DATA,\n      params: [\n        {\n          pid,\n          data: data[0],\n        },\n      ],\n    });\n  }\n\n  async _getData(): Promise<Record<string, unknown>> {\n    return this.request<Record<string, unknown>>({\n      allowedInteractions: [ALLOWED_INTERACTIONS.JRPC],\n      method: OPENLOGIN_METHOD.GET_DATA,\n      params: [{}],\n    });\n  }\n\n  _syncState(newState: Record<string, unknown>): void {\n    if (newState.store) {\n      if (typeof newState.store !== \"object\") {\n        throw new Error(\"expected store to be an object\");\n      }\n      Object.keys(newState.store).forEach((key) => {\n        // if privKey is available then user is not logged out, but in popup mode store info is not available.\n        // so we don't want to overwrite the local store if privKey is available\n        // and if latest iframe store data is not available\n        if (newState.privKey) {\n          if (newState.store[key]) {\n            this.state.store.set(key, newState.store[key]);\n          }\n        } else {\n          this.state.store.set(key, newState.store[key]);\n        }\n      });\n    }\n    const { store } = this.state;\n    this.state = { ...this.state, ...newState, store };\n  }\n\n  async _modal(params?: LoginParams & Partial<BaseRedirectParams>): Promise<{\n    privKey: string;\n  }> {\n    return new Promise<{ privKey: string }>((resolve, reject) => {\n      this.modal._prompt(this.state.clientId, this.state.whiteLabel, this.state.loginConfig, async (chunk: { cancel?: boolean }): Promise<void> => {\n        if (chunk.cancel) {\n          reject(new Error(\"user canceled login\"));\n        } else {\n          try {\n            const selectedLoginResponse = await this._selectedLogin(merge(params, chunk));\n            resolve(selectedLoginResponse);\n          } catch (error) {\n            reject(error);\n          }\n        }\n      });\n    });\n  }\n\n  async _cleanup(): Promise<void> {\n    await this.modal.cleanup();\n    this.provider.cleanup();\n  }\n\n  async encrypt(message: Buffer, privateKey?: string): Promise<Ecies> {\n    let privKey = privateKey;\n    if (!privKey) {\n      privKey = this.privKey;\n    }\n    // validations\n    if (!/^[0-9a-fA-f]{64}$/.exec(privKey)) {\n      if (privKey === \"\" || privKey === undefined) {\n        throw new Error(\"private key cannot be empty\");\n      } else {\n        throw new Error(\"invalid private key in encrypt\");\n      }\n    }\n    return encrypt(getPublic(Buffer.from(privKey, \"hex\")), message);\n  }\n\n  async decrypt(ciphertext: Ecies, privateKey?: string): Promise<Buffer> {\n    let privKey = privateKey;\n    if (!privKey) {\n      privKey = this.privKey;\n    }\n    // validations\n    if (!/^[0-9a-fA-f]{64}$/.exec(privKey)) {\n      if (privKey === \"\" || privKey === undefined) {\n        throw new Error(\"private key cannot be empty\");\n      } else {\n        throw new Error(\"invalid private key in decrypt\");\n      }\n    }\n    return decrypt(Buffer.from(privKey, \"hex\"), ciphertext);\n  }\n\n  async getUserInfo(): Promise<OpenloginUserInfo> {\n    if (this.privKey) {\n      const storeData = this.state.store.getStore();\n      const userInfo: OpenloginUserInfo = {\n        email: (storeData.email as string) || \"\",\n        name: (storeData.name as string) || \"\",\n        profileImage: (storeData.profileImage as string) || \"\",\n        aggregateVerifier: (storeData.aggregateVerifier as string) || \"\",\n        verifier: (storeData.verifier as string) || \"\",\n        verifierId: (storeData.verifierId as string) || \"\",\n        typeOfLogin: (storeData.typeOfLogin as LOGIN_PROVIDER_TYPE | CUSTOM_LOGIN_PROVIDER_TYPE) || \"\",\n      };\n\n      return userInfo;\n    }\n    throw new Error(\"user should be logged in to fetch userInfo\");\n  }\n\n  async getEncodedLoginUrl(loginParams: LoginParams & Partial<BaseRedirectParams>): Promise<string> {\n    const { redirectUrl } = loginParams;\n    const { clientId } = this.state;\n    if (!this.state.originData[origin]) {\n      await this.updateOriginData();\n    }\n    const dataObject = {\n      _clientId: clientId,\n      _origin: new URL(redirectUrl).origin,\n      _originData: this.state.originData,\n      redirectUrl,\n      ...loginParams,\n    };\n\n    const b64Params = jsonToBase64(dataObject);\n    const hashParams = {\n      b64Params,\n      _method: \"openlogin_login\",\n    };\n\n    return constructURL({ baseURL: `${this.state.iframeUrl}/start`, hash: hashParams });\n  }\n}\n\nexport default OpenLogin;\n","import {\n  createIdRemapMiddleware,\n  createStreamMiddleware,\n  JRPCEngine,\n  JRPCRequest,\n  ObjectMultiplex,\n  PostMessageStream,\n  SafeEventEmitter,\n  setupMultiplex,\n  Stream,\n} from \"@toruslabs/openlogin-jrpc\";\nimport { randomId } from \"@toruslabs/openlogin-utils\";\nimport pump from \"pump\";\n\nimport log from \"./loglevel\";\n\nexport default class Provider extends SafeEventEmitter {\n  iframeElem: HTMLIFrameElement | null = null;\n\n  rpcStream: PostMessageStream;\n\n  iframeUrl: string;\n\n  rpcEngine: JRPCEngine;\n\n  initialized: boolean;\n\n  mux: ObjectMultiplex;\n\n  init({ iframeElem, iframeUrl }: { iframeElem: HTMLIFrameElement; iframeUrl: string }): void {\n    this.iframeElem = iframeElem;\n    this.iframeUrl = iframeUrl;\n    this.setupStream();\n    this.initialized = true;\n  }\n\n  setupStream(): void {\n    if (this.iframeElem === null) throw new Error(\"iframe is null\");\n    this.rpcStream = new PostMessageStream({\n      name: \"embed_rpc\",\n      target: \"iframe_rpc\",\n      targetWindow: this.iframeElem.contentWindow,\n      targetOrigin: new URL(this.iframeUrl).origin,\n    });\n\n    this.mux = setupMultiplex(this.rpcStream);\n\n    const JRPCConnection = createStreamMiddleware();\n    pump(\n      JRPCConnection.stream as unknown as Stream,\n      this.mux.createStream(\"jrpc\") as unknown as Stream,\n      JRPCConnection.stream as unknown as Stream,\n      (error) => {\n        log.error(`JRPC connection broken`, error);\n      }\n    );\n\n    const rpcEngine = new JRPCEngine();\n    rpcEngine.push(createIdRemapMiddleware());\n    rpcEngine.push(JRPCConnection.middleware);\n    this.rpcEngine = rpcEngine;\n  }\n\n  cleanup(): void {\n    this.iframeElem = null;\n    this.initialized = false;\n  }\n\n  _rpcRequest(payload: JRPCRequest<unknown>, callback: (...args: unknown[]) => void): void {\n    if (!payload.jsonrpc) {\n      payload.jsonrpc = \"2.0\";\n    }\n    if (!payload.id) {\n      payload.id = randomId();\n    }\n    this.rpcEngine.handle(payload, callback);\n  }\n}\n","import { IStore } from \"./IStore\";\n\nexport class MemoryStore implements IStore {\n  store: Record<string, string> = {};\n\n  getItem(key: string): string {\n    return this.store[key];\n  }\n\n  setItem(key: string, value: string): void {\n    this.store[key] = value;\n  }\n}\n","import { storeKey } from \"./constants\";\nimport { IStore } from \"./IStore\";\nimport { MemoryStore } from \"./MemoryStore\";\nimport { localStorageAvailable } from \"./utils\";\n\nexport default class OpenLoginStore {\n  // eslint-disable-next-line no-use-before-define\n  private static instance: OpenLoginStore;\n\n  public storage: IStore;\n\n  private constructor(storage: IStore) {\n    this.storage = storage;\n    try {\n      if (!storage.getItem(storeKey)) {\n        this.resetStore();\n      }\n    } catch (error) {\n      // Storage is not available\n    }\n  }\n\n  static getInstance(): OpenLoginStore {\n    if (!this.instance) {\n      this.instance = new this(localStorageAvailable ? localStorage : new MemoryStore());\n    }\n    return this.instance;\n  }\n\n  toJSON(): string {\n    return this.storage.getItem(storeKey);\n  }\n\n  resetStore(): Record<string, unknown> {\n    const currStore = this.getStore();\n    this.storage.setItem(storeKey, JSON.stringify({}));\n    return currStore;\n  }\n\n  getStore(): Record<string, unknown> {\n    return JSON.parse(this.storage.getItem(storeKey));\n  }\n\n  get<T>(key: string): T {\n    const store = JSON.parse(this.storage.getItem(storeKey));\n    return store[key];\n  }\n\n  set<T>(key: string, value: T): void {\n    const store = JSON.parse(this.storage.getItem(storeKey));\n    store[key] = value;\n    this.storage.setItem(storeKey, JSON.stringify(store));\n  }\n}\n","module.exports = require(\"loglevel\");","module.exports = require(\"@toruslabs/http-helpers\");","module.exports = require(\"lodash.merge\");","module.exports = require(\"pump\");","export * from \"./constants\";\nexport * from \"./IStore\";\nexport { default as loglevel } from \"./loglevel\";\nexport { default } from \"./OpenLogin\";\nexport * from \"./OpenLogin\";\nexport { default as OpenLoginStore } from \"./OpenLoginStore\";\nexport { default as Provider } from \"./Provider\";\nexport * from \"./utils\";\n"],"sourceRoot":""}