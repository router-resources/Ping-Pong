{"version":3,"sources":["webpack://Torus/webpack/bootstrap","webpack://Torus/external \"@babel/runtime/helpers/defineProperty\"","webpack://Torus/external \"@toruslabs/openlogin-jrpc\"","webpack://Torus/external \"eth-rpc-errors\"","webpack://Torus/external \"@toruslabs/http-helpers\"","webpack://Torus/external \"pump\"","webpack://Torus/external \"@toruslabs/torus.js\"","webpack://Torus/external \"@metamask/obs-store\"","webpack://Torus/external \"@babel/runtime/helpers/objectWithoutProperties\"","webpack://Torus/external \"@toruslabs/fetch-node-details\"","webpack://Torus/external \"lodash.merge\"","webpack://Torus/external \"fast-deep-equal\"","webpack://Torus/external \"is-stream\"","webpack://Torus/external \"loglevel\"","webpack://Torus/external \"create-hash\"","webpack://Torus/external \"events\"","webpack://Torus/./src/interfaces.ts","webpack://Torus/./src/config.ts","webpack://Torus/./src/embedUtils.ts","webpack://Torus/./src/loglevel.ts","webpack://Torus/./src/messages.ts","webpack://Torus/./src/utils.ts","webpack://Torus/./src/inpage-provider.ts","webpack://Torus/./src/integrity.ts","webpack://Torus/./src/PopupHandler.ts","webpack://Torus/./src/siteMetadata.ts","webpack://Torus/./src/embed.ts","webpack://Torus/./src/index.ts"],"names":["LOGIN_PROVIDER","GOOGLE","FACEBOOK","TWITCH","REDDIT","DISCORD","WALLET_OPENLOGIN_VERIFIER_MAP","PAYMENT_PROVIDER","MOONPAY","WYRE","RAMPNETWORK","XANPOOL","MERCURYO","TRANSAK","TORUS_BUILD_ENV","PRODUCTION","DEVELOPMENT","BINANCE","TESTING","LRC","BETA","BUTTON_POSITION","BOTTOM_LEFT","TOP_LEFT","BOTTOM_RIGHT","TOP_RIGHT","paymentProviders","line1","line2","line3","supportPage","minOrderValue","maxOrderValue","validCurrencies","validCryptoCurrencies","includeFees","enforceMax","sell","translations","en","embed","continue","actionRequired","pendingAction","cookiesRequired","enableCookies","clickHere","de","ja","ko","zh","supportedVerifierList","api","prodTorusUrl","localStorageKey","window","location","hostname","runOnLoad","fn","Promise","resolve","reject","document","body","then","catch","addEventListener","runOnComplete","retry","setInterval","readyState","clearInterval","htmlToElement","html","template","createElement","trimmedHtml","trim","innerHTML","content","firstChild","handleEvent","handle","eventName","handler","handlerArgs","handlerWrapper","removeEventListener","handleStream","chunk","removeListener","on","documentReady","loglevel","getLogger","errors","disconnected","permanentlyDisconnected","sendSiteMetadata","unsupportedSync","method","invalidDuplexStream","invalidOptions","maxEventListeners","shouldSendMetadata","invalidRequestArgs","invalidRequestMethod","invalidRequestParams","invalidLoggerObject","invalidLoggerMethod","info","connected","chainId","warnings","enableDeprecation","sendDeprecation","events","close","data","networkChanged","notification","publicConfigStore","config","validatePaymentProvider","provider","params","isValid","Object","keys","length","selectedProvider","selectedParams","fiatValue","requestedOrderAmount","parseFloat","toString","selectedCurrency","includes","selectedCryptoCurrency","createErrorMiddleware","req","res","next","error","ethErrors","rpc","invalidRequest","message","done","log","getRpcPromiseCallback","unwrapResult","response","Array","isArray","result","logStreamDisconnectWarning","remoteLabel","emitter","warningMsg","stack","warn","listenerCount","emit","getPreopenInstanceId","Math","random","slice","getTorusUrl","buildEnv","integrity","torusUrl","logLevel","version","process","versionUsed","get","useAPIKey","getUserLanguage","userLanguage","navigator","language","userLanguages","split","prototype","hasOwnProperty","call","EMITTED_NOTIFICATIONS","NOOP","FEATURES_PROVIDER_CHANGE_WINDOW","FEATURES_DEFAULT_WALLET_WINDOW","FEATURES_DEFAULT_POPUP_WINDOW","FEATURES_CONFIRM_WINDOW","storageAvailable","type","storage","x","setItem","removeItem","e","code","name","getPopupFeatures","dualScreenLeft","screenLeft","undefined","screenX","dualScreenTop","screenTop","screenY","w","h","width","innerWidth","documentElement","clientWidth","screen","height","innerHeight","clientHeight","systemZoom","left","abs","top","features","SafeEventEmitter","defaultMaxListeners","TorusInpageProvider","constructor","connectionStream","jsonRpcStreamName","enable","experimentalMethods","send","isDuplexStream","Error","messages","isTorus","setMaxListeners","_state","_defaultState","selectedAddress","networkVersion","_handleAccountsChanged","bind","_handleChainChanged","_handleUnlockStateChanged","_handleConnect","_handleDisconnect","_handleStreamDisconnect","_sendSync","_rpcRequest","_warnOfDeprecation","_initializeState","request","sendAsync","mux","ObjectMultiplex","pump","_publicConfigStore","ObservableStore","storageKey","createStream","storeAsStream","ignoreStream","isConnected","jsonRpcConnection","createStreamMiddleware","stream","rpcEngine","JRPCEngine","push","createIdRemapMiddleware","middleware","_rpcEngine","payload","_sentWarnings","args","callback","addListener","listener","once","prependListener","prependOnceListener","accounts","isUnlocked","initialized","isInternal","cb","_payload","jsonrpc","err","tryPreopenHandle","methodOrPayload","callbackOrArgs","id","debug","isRecoverable","errorMessage","isPermanentlyDisconnected","EthereumRpcError","streamName","isEthAccounts","finalAccounts","account","dequal","hasEmittedConnection","defaults","options","algorithms","delimiter","full","hashes","internalHashes","forEach","algorithm","createHash","update","digest","sri","output","map","join","main","finalOptions","PopupHandler","EventEmitter","url","target","windowTimer","iClosedWindow","_setupTimer","Number","closed","open","href","focus","redirect","locationReplaceOnRedirect","replace","imgExists","img","onload","onerror","src","getSiteName","siteName","querySelector","metaTitle","title","getSiteIcon","icon","from","querySelectorAll","find","_icon","Boolean","getSiteMetadata","engine","domainMetadata","originalError","defaultVerifiers","iframeIntegrity","expectedCacheControlHeader","UNSAFE_METHODS","isLocalStorageAvailable","preLoadIframe","torusIframeHtml","check","hash","crossOrigin","rel","relList","supports","head","appendChild","Torus","buttonPosition","modalZIndex","apiKey","configuration","isLoggedIn","isInitialized","torusWidgetVisibility","requestedVerifier","currentVerifier","nodeDetailManager","NodeDetailManager","torusJs","TorusJs","metadataHost","allowHost","setAPIKey","alertZIndex","isIframeFullScreen","dappStorageKey","init","enableLogging","enabledVerifiers","network","host","networkName","blockExplorer","ticker","tickerName","loginConfig","showTorusButton","whiteLabel","skipTKey","useLocalStorage","useWalletConnect","setDefaultLevel","enableAll","disableAll","storedKey","localStorage","getItem","generatedKey","torusIframeUrl","URL","pathname","endsWith","torusIframe","torusAlertContainer","style","display","setProperty","link","setAttribute","styleLink","defaultLanguage","customTranslations","mergedTranslations","deepmerge","languageTranslations","embedTranslations","handleSetup","_setupWeb3","initStream","communicationMux","getStream","success","_displayIframe","write","fetchUrl","resp","fetch","cache","headers","text","calculatedIntegrity","generateIntegrity","clearInit","login","verifier","login_hint","loginHint","ethereum","logout","logOutStream","statusStream","statusStreamHandler","status","loggedIn","cleanUp","isElement","element","Element","HTMLDocument","contains","remove","torusAlert","hideTorusButton","_sendWidgetVisibilityStatus","setProvider","rest","providerChangeStream","preopenInstanceId","_handleWindow","override","showWallet","path","showWalletStream","finalPath","showWalletHandler","instanceId","finalUrl","searchParams","append","walletWindow","getPublicAddress","verifierId","isExtended","nodeDetails","getNodeDetails","endpoints","torusNodeEndpoints","torusNodePubs","torusNodePub","walletVerifier","openloginVerifier","existingV1User","getUserTypeAndAddress","typeOfUser","address","v2User","newV2User","getUserInfo","userInfoAccessStream","userInfoAccessHandler","approved","rejected","newRequest","userInfoStream","userInfoHandler","handlerChunk","initiateTopup","JSON","stringify","topupStream","topupHandler","loginWithPrivateKey","loginParams","privateKey","userInfo","Buffer","loginPrivKeyStream","loginHandler","showWalletConnectScanner","walletConnectStream","walletConnectHandler","windowStream","handledWindow","_createPopupBlockAlert","closeHandler","receivedId","_setEmbedWhiteLabel","theme","isDark","colors","classList","add","torusBrand1","torusGray2","_getLogoUrl","logoUrl","logoLight","logoDark","torusWidgetVisibilityStream","isFull","right","bottom","assign","metamaskStream","BasePostMessageStream","targetWindow","contentWindow","targetOrigin","origin","communicationStream","inpageProvider","detectAccountRequestPrototypeModifier","m","originalMethod","providerFunc","apply","setTimeout","handleLoginCb","_","_showLoginPopup","isLoginCallback","proxiedInpageProvider","Proxy","deleteProperty","setupMultiplex","widgetStream","calledFromEmbed","oauthStream","successAlert","btnContainer","bindOnLoad","children","attachOnLoad"],"mappings":"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","file":"torus.cjs.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 15);\n","module.exports = require(\"@babel/runtime/helpers/defineProperty\");","module.exports = require(\"@toruslabs/openlogin-jrpc\");","module.exports = require(\"eth-rpc-errors\");","module.exports = require(\"@toruslabs/http-helpers\");","module.exports = require(\"pump\");","module.exports = require(\"@toruslabs/torus.js\");","module.exports = require(\"@metamask/obs-store\");","module.exports = require(\"@babel/runtime/helpers/objectWithoutProperties\");","module.exports = require(\"@toruslabs/fetch-node-details\");","module.exports = require(\"lodash.merge\");","module.exports = require(\"fast-deep-equal\");","module.exports = require(\"is-stream\");","module.exports = require(\"loglevel\");","module.exports = require(\"create-hash\");","module.exports = require(\"events\");","import { JRPCId, JRPCMiddleware, JRPCRequest, JRPCVersion, SafeEventEmitter } from \"@toruslabs/openlogin-jrpc\";\nimport createHash from \"create-hash\";\nimport type { Duplex } from \"readable-stream\";\n\nexport const LOGIN_PROVIDER = {\n  GOOGLE: \"google\",\n  FACEBOOK: \"facebook\",\n  TWITCH: \"twitch\",\n  REDDIT: \"reddit\",\n  DISCORD: \"discord\",\n} as const;\n\nexport const WALLET_OPENLOGIN_VERIFIER_MAP = {\n  [LOGIN_PROVIDER.GOOGLE]: \"tkey-google\",\n  [LOGIN_PROVIDER.FACEBOOK]: \"tkey-facebook\",\n  [LOGIN_PROVIDER.TWITCH]: \"tkey-twitch\",\n  [LOGIN_PROVIDER.REDDIT]: \"tkey-reddit\",\n  [LOGIN_PROVIDER.DISCORD]: \"tkey-discord\",\n} as const;\nexport const PAYMENT_PROVIDER = {\n  MOONPAY: \"moonpay\",\n  WYRE: \"wyre\",\n  RAMPNETWORK: \"rampnetwork\",\n  XANPOOL: \"xanpool\",\n  MERCURYO: \"mercuryo\",\n  TRANSAK: \"transak\",\n} as const;\n\nexport const TORUS_BUILD_ENV = {\n  PRODUCTION: \"production\",\n  DEVELOPMENT: \"development\",\n  BINANCE: \"binance\",\n  TESTING: \"testing\",\n  LRC: \"lrc\",\n  BETA: \"beta\",\n} as const;\n\nexport type PAYMENT_PROVIDER_TYPE = typeof PAYMENT_PROVIDER[keyof typeof PAYMENT_PROVIDER];\n\nexport type TORUS_BUILD_ENV_TYPE = typeof TORUS_BUILD_ENV[keyof typeof TORUS_BUILD_ENV];\n\nexport interface IPaymentProvider {\n  line1: string;\n  line2: string;\n  line3: string;\n  supportPage: string;\n  minOrderValue: number;\n  maxOrderValue: number;\n  validCurrencies: string[];\n  validCryptoCurrencies: string[];\n  includeFees: boolean;\n  enforceMax: boolean;\n  sell?: boolean;\n}\n\nexport interface IHashAlgorithmOptions {\n  algorithms?: createHash.algorithm[];\n  delimiter?: string;\n  full?: boolean;\n}\n\nexport interface SRI {\n  hashes: Record<createHash.algorithm, string>;\n  integrity?: string;\n}\n\nexport const BUTTON_POSITION = {\n  BOTTOM_LEFT: \"bottom-left\",\n  TOP_LEFT: \"top-left\",\n  BOTTOM_RIGHT: \"bottom-right\",\n  TOP_RIGHT: \"top-right\",\n} as const;\n\nexport type EMBED_TRANSLATION_ITEM = {\n  continue: string;\n  actionRequired: string;\n  pendingAction: string;\n  cookiesRequired: string;\n  enableCookies: string;\n  clickHere: string;\n};\n\nexport type BUTTON_POSITION_TYPE = typeof BUTTON_POSITION[keyof typeof BUTTON_POSITION];\n\nexport type WALLET_PATH = \"transfer\" | \"topup\" | \"home\" | \"settings\" | \"history\";\nexport type ETHEREUM_NETWORK_TYPE =\n  | \"ropsten\"\n  | \"rinkeby\"\n  | \"kovan\"\n  | \"mainnet\"\n  | \"goerli\"\n  | \"localhost\"\n  | \"matic\"\n  | \"mumbai\"\n  | \"xdai\"\n  | \"bsc_mainnet\"\n  | \"bsc_testnet\";\n\nexport type LOGIN_TYPE =\n  | \"google\"\n  | \"facebook\"\n  | \"reddit\"\n  | \"discord\"\n  | \"twitch\"\n  | \"apple\"\n  | \"github\"\n  | \"linkedin\"\n  | \"twitter\"\n  | \"weibo\"\n  | \"line\"\n  | \"jwt\"\n  | \"email_password\"\n  | \"passwordless\";\n\nexport interface TorusCtorArgs {\n  /**\n   * Determines where the torus widget is visible on the page.\n   * @defaultValue bottom-left\n   */\n  buttonPosition?: BUTTON_POSITION_TYPE;\n\n  /**\n   * Z-index of the modal and iframe\n   * @defaultValue 99999\n   */\n  modalZIndex?: number;\n\n  /**\n   * Api key\n   * Get yours today at {@link https://developer.tor.us | Dashboard}\n   */\n  apiKey?: string;\n}\n\nexport interface TorusLoginParams {\n  verifier?: string;\n  login_hint?: string;\n}\n\nexport interface NetworkInterface {\n  /**\n   * If any network other than the ones in enum, it should a JSON RPC URL\n   */\n  host: ETHEREUM_NETWORK_TYPE | string;\n  /**\n   * chainId for the network. If not provided, we query the host\n   */\n  chainId?: number;\n  /**\n   * Name of the network\n   */\n  networkName?: string;\n  /**\n   * Url of the block explorer\n   */\n  blockExplorer?: string;\n  /**\n   * Default currency ticker of the network (e.g: BNB)\n   */\n  ticker?: string;\n  /**\n   * Name for currency ticker (e.g: `Binance Coin`)\n   */\n  tickerName?: string;\n}\n\nexport interface BaseLoginOptions {\n  /**\n   * If you need to send custom parameters to the Authorization Server,\n   * make sure to use the original parameter name.\n   */\n  [key: string]: unknown;\n  /**\n   * - `'page'`: displays the UI with a full page view\n   * - `'popup'`: displays the UI with a popup window\n   * - `'touch'`: displays the UI in a way that leverages a touch interface\n   * - `'wap'`: displays the UI with a \"feature phone\" type interface\n   */\n  display?: \"page\" | \"popup\" | \"touch\" | \"wap\";\n  /**\n   * - `'none'`: do not prompt user for login or consent on reauthentication\n   * - `'login'`: prompt user for reauthentication\n   * - `'consent'`: prompt user for consent before processing request\n   * - `'select_account'`: prompt user to select an account\n   */\n  prompt?: \"none\" | \"login\" | \"consent\" | \"select_account\";\n  /**\n   * Maximum allowable elasped time (in seconds) since authentication.\n   * If the last time the user authenticated is greater than this value,\n   * the user must be reauthenticated.\n   */\n  max_age?: string | number;\n  /**\n   * The space-separated list of language tags, ordered by preference.\n   * For example: `'fr-CA fr en'`.\n   */\n  ui_locales?: string;\n  /**\n   * Previously issued ID Token.\n   */\n  id_token_hint?: string;\n  /**\n   * The user's email address or other identifier. When your app knows\n   * which user is trying to authenticate, you can provide this parameter\n   * to pre-fill the email box or select the right session for sign-in.\n   *\n   * This currently only affects the classic Lock experience.\n   */\n  login_hint?: string;\n  acr_values?: string;\n  /**\n   * The default scope to be used on authentication requests.\n   * The defaultScope defined in the Auth0Client is included\n   * along with this scope\n   */\n  scope?: string;\n  /**\n   * The default audience to be used for requesting API access.\n   */\n  audience?: string;\n  /**\n   * The name of the connection configured for your application.\n   * If null, it will redirect to the Auth0 Login Page and show\n   * the Login Widget.\n   */\n  connection?: string;\n}\n\nexport interface JwtParameters extends BaseLoginOptions {\n  /**\n   * Your Auth0 account domain such as `'example.auth0.com'`,\n   * `'example.eu.auth0.com'` or , `'example.mycompany.com'`\n   * (when using [custom domains](https://auth0.com/docs/custom-domains))\n   */\n  domain: string;\n  /**\n   * The Client ID found on your Application settings page\n   */\n  client_id?: string;\n  /**\n   * The default URL where Auth0 will redirect your browser to with\n   * the authentication result. It must be whitelisted in\n   * the \"Allowed Callback URLs\" field in your Auth0 Application's\n   * settings. If not provided here, it should be provided in the other\n   * methods that provide authentication.\n   */\n  redirect_uri?: string;\n  /**\n   * The value in seconds used to account for clock skew in JWT expirations.\n   * Typically, this value is no more than a minute or two at maximum.\n   * Defaults to 60s.\n   */\n  leeway?: number;\n\n  /**\n   * The field in jwt token which maps to verifier id\n   */\n  verifierIdField?: string;\n\n  /**\n   * Whether the verifier id field is case sensitive\n   * @defaultValue true\n   */\n  isVerifierIdCaseSensitive?: boolean;\n}\n\nexport interface LoginConfigItem {\n  /**\n   * Display Name. If not provided, we use the default for torus app\n   */\n  name: string;\n  /**\n   * The type of login. Refer to enum `LOGIN_TYPE`\n   */\n  typeOfLogin: LOGIN_TYPE;\n  /**\n   * Description for button. If provided, it renders as a full length button. else, icon button\n   */\n  description?: string;\n  /**\n   * Custom client_id. If not provided, we use the default for torus app\n   */\n  clientId?: string;\n  /**\n   * Logo to be shown on mouse hover. If not provided, we use the default for torus app\n   */\n  logoHover?: string;\n  /**\n   * Logo to be shown on dark background (dark theme). If not provided, we use the default for torus app\n   */\n  logoLight?: string;\n  /**\n   * Logo to be shown on light background (light theme). If not provided, we use the default for torus app\n   */\n  logoDark?: string;\n  /**\n   * Whether to show the login button on modal or not\n   */\n  showOnModal?: boolean;\n  /**\n   * Whether to show the login button on mobile\n   */\n  showOnMobile?: boolean;\n  /**\n   * Custom jwt parameters to configure the login. Useful for Auth0 configuration\n   */\n  jwtParameters?: JwtParameters;\n  /**\n   * Show login button on the main list\n   */\n  mainOption?: boolean;\n  /**\n   * Whether to show the login button on desktop\n   */\n  showOnDesktop?: boolean;\n  /**\n   * Modify the order of buttons. Should be greater than zero, where 1 is top priority.\n   */\n  priority?: number;\n}\n\nexport interface LoginConfig {\n  /**\n   * Use the verifier provided by torus as a key or a default verifier used by torus\n   * {@link https://docs.tor.us/torus-wallet/developing-with-torus-wallet/oauth | Documentation}\n   */\n  [verifier: string]: LoginConfigItem;\n}\n\nexport interface TorusNodePub {\n  /**\n   * X component of a Public Key\n   */\n  X: string;\n  /**\n   * Y component of a Public Key\n   */\n  Y: string;\n}\n\nexport interface TorusPublicKey extends TorusNodePub {\n  /**\n   * Ethereum Public Address\n   */\n  address: string;\n}\n\nexport interface PaymentParams {\n  /**\n   * Address to send the funds to\n   */\n  selectedAddress?: string;\n  /**\n   * Default fiat currency for the user to make the payment in\n   */\n  selectedCurrency?: string;\n  /**\n   * Amount to buy in the selectedCurrency\n   */\n  fiatValue?: number;\n  /**\n   * Cryptocurrency to buy\n   */\n  selectedCryptoCurrency?: string;\n}\n\nexport interface VerifierArgs {\n  /**\n   * Verifier Enum\n   */\n  verifier: \"google\" | \"reddit\" | \"discord\";\n  /**\n   * email for google\n   *\n   * username for reddit\n   *\n   * id for discord\n   */\n  verifierId: string;\n  /**\n   * If true, returns {@link TorusPublicKey}, else returns string\n   */\n  isExtended?: boolean;\n}\n\nexport interface LoginParams {\n  verifier?: string;\n  login_hint?: string;\n}\n\nexport interface UserInfo {\n  /**\n   * Email of the logged in user\n   */\n  email: string;\n  /**\n   * Full name of the logged in user\n   */\n  name: string;\n  /**\n   * Profile image of the logged in user\n   */\n  profileImage: string;\n  /**\n   * verifier of the logged in user (google, facebook etc)\n   */\n  verifier: string;\n  /**\n   * Verifier Id of the logged in user\n   *\n   * email for google,\n   * id for facebook,\n   * username for reddit,\n   * id for twitch,\n   * id for discord\n   */\n  verifierId: string;\n  /**\n   * Returns if the logged in user is new\n   */\n  isNewUser: boolean;\n\n  /**\n   * login type of the logged in user (google, facebook etc)\n   */\n  typeOfLogin: LOGIN_TYPE;\n}\n\nexport interface LocaleLinks<T> {\n  /**\n   * Item corresponding to english\n   */\n  en?: T;\n  /**\n   * Item corresponding to japanese\n   */\n  ja?: T;\n  /**\n   * Item corresponding to korean\n   */\n  ko?: T;\n  /**\n   * Item corresponding to german\n   */\n  de?: T;\n  /**\n   * Item corresponding to chinese (simplified)\n   */\n  zh?: T;\n  /**\n   * Item corresponding to spanish\n   */\n  es?: T;\n}\n\nexport interface ThemeParams {\n  /**\n   * If true, enables dark mode\n   * Defaults to false\n   * @defaultValue false\n   */\n  isDark: boolean;\n  /**\n   * Colors object to customize colors in torus theme.\n   *\n   * Contact us for whitelabel. Example provided in `examples/vue-app`\n   */\n  colors: Record<string, string>;\n}\n\nexport interface IntegrityParams {\n  /**\n   * Whether to check for integrity.\n   * Defaults to false\n   * @defaultValue false\n   */\n  check: boolean;\n  /**\n   * if check is true, hash must be provided. The SRI sha-384 integrity hash\n   * {@link https://www.srihash.org/ | SRI Hash}\n   */\n  hash?: string;\n  /**\n   * Version of torus-website to load\n   */\n  version?: string;\n}\n\nexport interface VerifierStatus {\n  /**\n   * Defaults to true\n   * @defaultValue true\n   */\n  google?: boolean;\n  /**\n   * Defaults to true\n   * @defaultValue true\n   */\n  facebook?: boolean;\n  /**\n   * Defaults to true\n   * @defaultValue true\n   */\n  reddit?: boolean;\n  /**\n   * Defaults to true\n   * @defaultValue true\n   */\n  twitch?: boolean;\n  /**\n   * Defaults to true\n   * @defaultValue true\n   */\n  discord?: boolean;\n}\n\nexport interface WhiteLabelParams {\n  /**\n   * Whitelabel theme\n   */\n  theme: ThemeParams;\n  /**\n   * Language of whitelabel.\n   *\n   * order of preference: Whitelabel language \\> user language (in torus-website) \\> browser language\n   */\n  defaultLanguage?: string;\n  /**\n   * Logo Url to be used in light mode (dark logo)\n   */\n  logoDark: string;\n  /**\n   * Logo Url to be used in dark mode (light logo)\n   */\n  logoLight: string;\n  /**\n   * Shows/hides topup option in torus-website/widget.\n   * Defaults to false\n   * @defaultValue false\n   */\n  topupHide?: boolean;\n  /**\n   * Shows/hides billboard in torus-website.\n   * Defaults to false\n   * @defaultValue false\n   */\n  featuredBillboardHide?: boolean;\n  /**\n   * Shows/hides disclaimers on login page. Only works if special logins are hidden\n   * Defaults to false\n   * @defaultValue false\n   */\n  disclaimerHide?: boolean;\n  /**\n   * Language specific link for terms and conditions on torus-website. See (examples/vue-app) to configure\n   */\n  tncLink?: LocaleLinks<string>;\n  /**\n   * Language specific link for privacy policy on torus-website. See (examples/vue-app) to configure\n   */\n  privacyPolicy?: LocaleLinks<string>;\n  /**\n   * Language specific link for privacy policy on torus-website. See (examples/vue-app) to configure\n   */\n  contactLink?: LocaleLinks<string>;\n  /**\n   * Custom translations. See (examples/vue-app) to configure\n   */\n  customTranslations?: LocaleLinks<unknown>;\n}\n\nexport interface TorusParams {\n  /**\n   * Torus Network Object\n   */\n  network?: NetworkInterface;\n  /**\n   * Build Environment of Torus.\n   *\n   * production uses https://app.tor.us,\n   *\n   * development uses http://localhost:4050 (expects torus-website to be run locally),\n   *\n   * binance uses https://binance.tor.us,\n   *\n   * lrc uses https://lrc.tor.us,\n   *\n   * beta uses https://beta.tor.us, (currently supports tkey)\n   *\n   * testing uses https://testing.tor.us (latest internal build)\n   * @defaultValue production\n   */\n  buildEnv?: TORUS_BUILD_ENV_TYPE;\n  /**\n   * Enables or disables logging.\n   *\n   * Defaults to false in prod and true in other environments\n   */\n  enableLogging?: boolean;\n  /**\n   * whether to show/hide torus widget.\n   *\n   * Defaults to true\n   * @defaultValue true\n   */\n  showTorusButton?: boolean;\n  /**\n   * setting false, hides those verifiers from login modal\n   * @deprecated\n   * Please use loginConfig instead\n   */\n  enabledVerifiers?: VerifierStatus;\n  /**\n   * Array of login config items. Used to modify the default logins/ add new logins\n   */\n  loginConfig?: LoginConfig;\n  /**\n   * Params to enable integrity checks and load specific versions of torus-website\n   */\n  integrity?: IntegrityParams;\n  /**\n   * Params to enable whitelabelling of torus website and widget\n   */\n  whiteLabel?: WhiteLabelParams;\n  /**\n   * Skips TKey onboarding for new users\n   *\n   * Defaults to false\n   * @defaultValue false\n   */\n  skipTKey?: boolean;\n  /**\n   * Prefers to use localStorage instead of sessionStorage for torus iframe. Allows longer lived sessions\n   *\n   * Defaults to false\n   * @defaultValue false\n   */\n  useLocalStorage?: boolean;\n\n  /**\n   * Setting `useWalletConnect` to true allows to display wallet connect qr scanner from torus-embed.\n   *\n   * Defaults to false\n   * @defaultValue false\n   */\n  useWalletConnect?: boolean;\n}\n\nexport interface UnvalidatedJsonRpcRequest {\n  id?: JRPCId;\n  jsonrpc?: JRPCVersion;\n  method: string;\n  params?: unknown;\n  preopenInstanceId?: string;\n}\n\nexport interface ProviderOptions {\n  /**\n   * The name of the stream used to connect to the wallet.\n   */\n  jsonRpcStreamName?: string;\n\n  /**\n   * The maximum number of event listeners.\n   */\n  maxEventListeners?: number;\n  /**\n   * Whether the provider should send page metadata.\n   */\n  shouldSendMetadata?: boolean;\n}\n\nexport interface RequestArguments {\n  /** The RPC method to request. */\n  method: string;\n\n  /** The params of the RPC method, if any. */\n  params?: unknown[] | Record<string, unknown>;\n}\n\nexport interface BaseProviderState {\n  accounts: null | string[];\n  isConnected: boolean;\n  isUnlocked: boolean;\n  initialized: boolean;\n  isPermanentlyDisconnected: boolean;\n  hasEmittedConnection: boolean;\n}\n\nexport interface JsonRpcConnection {\n  events: SafeEventEmitter;\n  middleware: JRPCMiddleware<unknown, unknown>;\n  stream: Duplex;\n}\n\nexport interface SentWarningsState {\n  // methods\n  enable: boolean;\n  experimentalMethods: boolean;\n  send: boolean;\n  publicConfigStore: boolean;\n  // events\n  events: {\n    close: boolean;\n    data: boolean;\n    networkChanged: boolean;\n    notification: boolean;\n  };\n}\n\nexport interface SendSyncJsonRpcRequest extends JRPCRequest<unknown> {\n  method: \"eth_accounts\" | \"eth_coinbase\" | \"eth_uninstallFilter\" | \"net_version\";\n}\n\nexport interface PublicConfigState {\n  isUnlocked?: boolean;\n  selectedAddress?: string;\n  chainId?: string;\n  networkVersion?: string;\n  storageKey: string;\n}\n\nexport type Maybe<T> = Partial<T> | null | undefined;\n\nexport type BufferEncoding = \"ascii\" | \"utf8\" | \"utf-8\" | \"utf16le\" | \"ucs2\" | \"ucs-2\" | \"base64\" | \"base64url\" | \"latin1\" | \"binary\" | \"hex\";\n\nexport type IObjectMultiplex = Duplex;\n\nexport type WalletProviderState = {\n  accounts: string[];\n  chainId: string;\n  isUnlocked: boolean;\n  networkVersion: string;\n};\n","import { EMBED_TRANSLATION_ITEM, IPaymentProvider, LocaleLinks, LOGIN_PROVIDER, PAYMENT_PROVIDER } from \"./interfaces\";\n\nconst paymentProviders = {\n  [PAYMENT_PROVIDER.RAMPNETWORK]: {\n    line1: \"Debit Card/ Apple Pay/ Bank transfer\",\n    line2: \"0.49% - 2.9%\",\n    line3: \"5,000€/purchase, 20,000€/mo\",\n    supportPage: \"https://instant.ramp.network/\",\n    minOrderValue: 50,\n    maxOrderValue: 20000,\n    validCurrencies: [\"GBP\", \"EUR\", \"USD\"],\n    validCryptoCurrencies: [\"ETH\", \"DAI\", \"USDC\", \"BSC_BNB\"],\n    includeFees: true,\n    enforceMax: false,\n  } as IPaymentProvider,\n  [PAYMENT_PROVIDER.MOONPAY]: {\n    line1: \"Credit / Debit Card / Apple Pay\",\n    line2: \"4.5% or 5 USD\",\n    line3: \"2,000€/day, 10,000€/mo\",\n    supportPage: \"https://help.moonpay.io/en/\",\n    minOrderValue: 24.99,\n    maxOrderValue: 50000,\n    validCurrencies: [\"USD\", \"EUR\", \"GBP\", \"AUD\", \"CAD\", \"SGD\", \"RUB\"],\n    validCryptoCurrencies: [\"ETH\", \"DAI\", \"TUSD\", \"USDC\", \"USDT\", \"BNB_BSC\", \"BUSD_BSC\"],\n    includeFees: true,\n    enforceMax: false,\n  } as IPaymentProvider,\n  [PAYMENT_PROVIDER.WYRE]: {\n    line1: \"Apple Pay/ Debit/ Credit Card\",\n    line2: \"4.9% + 30¢ or 5 USD\",\n    line3: \"$250/day\",\n    supportPage: \"https://support.sendwyre.com/en/\",\n    minOrderValue: 5,\n    maxOrderValue: 500,\n    validCurrencies: [\"USD\", \"AUD\", \"CAD\", \"GBP\", \"EUR\"],\n    validCryptoCurrencies: [\"ETH\", \"DAI\", \"USDC\", \"USDT\"],\n    includeFees: false,\n    enforceMax: false,\n  } as IPaymentProvider,\n  [PAYMENT_PROVIDER.XANPOOL]: {\n    line1: \"PayNow/ InstaPay/ FPS/ GoJekPay/ UPI/ PromptPay/ VietelPay/ DuitNow\",\n    line2: \"2.5% buying, 3% selling\",\n    line3: \"$2,500 / day\",\n    supportPage: \"mailto:support@xanpool.com\",\n    minOrderValue: 100,\n    maxOrderValue: 2500,\n    validCurrencies: [\"SGD\", \"HKD\", \"MYR\", \"PHP\", \"INR\", \"VND\", \"THB\", \"IDR\"],\n    validCryptoCurrencies: [\"ETH\", \"USDT\"],\n    includeFees: true,\n    sell: true,\n    enforceMax: false,\n  } as IPaymentProvider,\n  [PAYMENT_PROVIDER.MERCURYO]: {\n    line1: \"Credit/ Debit Card/ Apple Pay\",\n    line2: \"3.95% or 4 USD\",\n    line3: \"10,000€/day, 25,000€/mo\",\n    supportPage: \"mailto:support@mercuryo.io\",\n    minOrderValue: 30,\n    maxOrderValue: 5000,\n    validCurrencies: [\"USD\", \"EUR\", \"RUB\", \"TRY\", \"GBP\", \"UAH\"],\n    validCryptoCurrencies: [\"ETH\", \"DAI\", \"BAT\", \"USDT\", \"OKB\"],\n    includeFees: true,\n    enforceMax: false,\n  } as IPaymentProvider,\n  [PAYMENT_PROVIDER.TRANSAK]: {\n    line1: \"Credit/ Debit Card/ <br/>Bank Transfer (sepa/gbp)\",\n    line2: \"0.99% - 5.5% or 5 USD\",\n    line3: \"500€/day\",\n    supportPage: \"https://support.transak.com/hc/en-US\",\n    minOrderValue: 20,\n    maxOrderValue: 500,\n    validCurrencies: [\"USD\", \"EUR\", \"GBP\", \"AUD\", \"CAD\", \"SGD\"],\n    validCryptoCurrencies: [\"ETH\", \"DAI\", \"USDC\", \"USDT\"],\n    includeFees: true,\n    enforceMax: false,\n  } as IPaymentProvider,\n};\n\nconst translations = {\n  en: {\n    embed: {\n      continue: \"Continue\",\n      actionRequired: \"Authorization required\",\n      pendingAction: \"Click continue to proceed with your request in a popup\",\n      cookiesRequired: \"Cookies Required\",\n      enableCookies: \"Please enable cookies in your browser preferences to access Torus\",\n      clickHere: \"More Info\",\n    },\n  },\n  de: {\n    embed: {\n      continue: \"Fortsetzen\",\n      actionRequired: \"Autorisierung erforderlich\",\n      pendingAction: \"Klicken Sie in einem Popup auf Weiter, um mit Ihrer Anfrage fortzufahren\",\n      cookiesRequired: \"Cookies benötigt\",\n      enableCookies: \"Bitte aktivieren Sie Cookies in Ihren Browsereinstellungen, um auf Torus zuzugreifen\",\n      clickHere: \"Mehr Info\",\n    },\n  },\n  ja: {\n    embed: {\n      continue: \"継続する\",\n      actionRequired: \"認証が必要です\",\n      pendingAction: \"続行をクリックして、ポップアップでリクエストを続行します\",\n      cookiesRequired: \"必要なクッキー\",\n      enableCookies: \"Torusにアクセスするには、ブラウザの設定でCookieを有効にしてください。\",\n      clickHere: \"詳しくは\",\n    },\n  },\n  ko: {\n    embed: {\n      continue: \"계속하다\",\n      actionRequired: \"승인 필요\",\n      pendingAction: \"팝업에서 요청을 진행하려면 계속을 클릭하십시오.\",\n      cookiesRequired: \"쿠키 필요\",\n      enableCookies: \"브라우저 환경 설정에서 쿠키를 활성화하여 Torus에 액세스하십시오.\",\n      clickHere: \"더 많은 정보\",\n    },\n  },\n  zh: {\n    embed: {\n      continue: \"继续\",\n      actionRequired: \"需要授权\",\n      pendingAction: \"单击继续以在弹出窗口中继续您的请求\",\n      cookiesRequired: \"必填Cookie\",\n      enableCookies: \"请在您的浏览器首选项中启用cookie以访问Torus。\",\n      clickHere: \"更多信息\",\n    },\n  },\n} as LocaleLinks<{ embed: EMBED_TRANSLATION_ITEM }>;\n\nexport default {\n  supportedVerifierList: [LOGIN_PROVIDER.GOOGLE, LOGIN_PROVIDER.REDDIT, LOGIN_PROVIDER.DISCORD],\n  paymentProviders,\n  api: \"https://api.tor.us\",\n  translations,\n  prodTorusUrl: \"\",\n  localStorageKey: `torus-${window.location.hostname}`,\n};\n","import { Stream } from \"pump\";\n\nexport const runOnLoad = (fn: () => void): Promise<unknown> =>\n  new Promise((resolve, reject) => {\n    if (window.document.body != null) {\n      Promise.resolve(fn()).then(resolve).catch(reject);\n    } else {\n      window.document.addEventListener(\"DOMContentLoaded\", () => {\n        Promise.resolve(fn()).then(resolve).catch(reject);\n      });\n    }\n  });\n\nexport const runOnComplete = (fn: () => void): void => {\n  const retry = window.setInterval(() => {\n    if (window.document.readyState === \"complete\") {\n      window.clearInterval(retry);\n      fn();\n    }\n  }, 300);\n};\n\nexport const htmlToElement = <T extends Element>(html: string): T => {\n  const template = window.document.createElement(\"template\");\n  const trimmedHtml = html.trim(); // Never return a text node of whitespace as the result\n  template.innerHTML = trimmedHtml;\n  return template.content.firstChild as T;\n};\n\nexport const handleEvent = (handle: EventTarget, eventName: string, handler: (...args: unknown[]) => void, ...handlerArgs: unknown[]): void => {\n  const handlerWrapper = () => {\n    handler(...handlerArgs);\n    handle.removeEventListener(eventName, handlerWrapper);\n  };\n  handle.addEventListener(eventName, handlerWrapper);\n};\n\nexport const handleStream = (handle: Stream, eventName: string, handler: (chunk: unknown) => void): void => {\n  const handlerWrapper = (chunk: unknown) => {\n    handler(chunk);\n    handle.removeListener(eventName, handlerWrapper);\n  };\n  handle.on(eventName, handlerWrapper);\n};\n\nexport async function documentReady(): Promise<void> {\n  return new Promise<void>((resolve) => {\n    if (document.readyState !== \"loading\") {\n      resolve();\n    } else {\n      handleEvent(document, \"DOMContentLoaded\", resolve);\n    }\n  });\n}\n","import loglevel from \"loglevel\";\n\nexport default loglevel.getLogger(\"torus-embed\");\n","export default {\n  errors: {\n    disconnected: (): string => \"Torus: Lost connection to Torus.\",\n    permanentlyDisconnected: (): string => \"Torus: Disconnected from iframe. Page reload required.\",\n    sendSiteMetadata: (): string => \"Torus: Failed to send site metadata. This is an internal error, please report this bug.\",\n    unsupportedSync: (method: string): string =>\n      `Torus: The Torus Ethereum provider does not support synchronous methods like ${method} without a callback parameter.`,\n    invalidDuplexStream: (): string => \"Must provide a Node.js-style duplex stream.\",\n    invalidOptions: (maxEventListeners: number, shouldSendMetadata: boolean): string =>\n      `Invalid options. Received: { maxEventListeners: ${maxEventListeners}, shouldSendMetadata: ${shouldSendMetadata} }`,\n    invalidRequestArgs: (): string => `Expected a single, non-array, object argument.`,\n    invalidRequestMethod: (): string => `'args.method' must be a non-empty string.`,\n    invalidRequestParams: (): string => `'args.params' must be an object or array if provided.`,\n    invalidLoggerObject: (): string => `'args.logger' must be an object if provided.`,\n    invalidLoggerMethod: (method: string): string => `'args.logger' must include required method '${method}'.`,\n  },\n  info: {\n    connected: (chainId: string): string => `Torus: Connected to chain with ID \"${chainId}\".`,\n  },\n  warnings: {\n    // deprecated methods\n    enableDeprecation:\n      'Torus: \"\"ethereum.enable()\" is deprecated and may be removed in the future. ' +\n      'Please use \"ethereum.send(\"eth_requestAccounts\")\" instead. For more information, see: https://eips.ethereum.org/EIPS/eip-1102',\n    sendDeprecation:\n      'Torus: \"ethereum.send(...)\" is deprecated and may be removed in the future.' +\n      ' Please use \"ethereum.sendAsync(...)\" or \"ethereum.request(...)\" instead.\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193',\n    events: {\n      close:\n        'Torus: The event \"close\" is deprecated and may be removed in the future. Please use \"disconnect\" instead.' +\n        \"\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193\",\n      data:\n        'Torus: The event \"data\" is deprecated and will be removed in the future.' +\n        'Use \"message\" instead.\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193#message',\n      networkChanged:\n        'Torus: The event \"networkChanged\" is deprecated and may be removed in the future.' +\n        ' Please use \"chainChanged\" instead.\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193',\n      notification:\n        'Torus: The event \"notification\" is deprecated and may be removed in the future. ' +\n        'Please use \"message\" instead.\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193',\n    },\n    publicConfigStore: 'Torus: The property \"publicConfigStore\" is deprecated and WILL be removed in the future.',\n  },\n};\n","import { get } from \"@toruslabs/http-helpers\";\nimport { JRPCMiddleware, PendingJRPCResponse, SafeEventEmitter } from \"@toruslabs/openlogin-jrpc\";\nimport { ethErrors } from \"eth-rpc-errors\";\nimport { LogLevelDesc } from \"loglevel\";\n\nimport config from \"./config\";\nimport { IntegrityParams, PaymentParams } from \"./interfaces\";\nimport log from \"./loglevel\";\n\nconst { paymentProviders } = config;\n\ntype PaymentErrorParams = {\n  fiatValue?: string;\n  selectedCurrency?: string;\n  selectedCryptoCurrency?: string;\n};\n\ntype PaymentErrors = { provider?: string } & PaymentErrorParams;\n\nexport const validatePaymentProvider = (provider: string, params: PaymentParams): { errors: PaymentErrors; isValid: boolean } => {\n  const errors: PaymentErrors = {};\n\n  if (!provider) {\n    return { errors, isValid: true };\n  }\n\n  if (provider && !paymentProviders[provider]) {\n    errors.provider = \"Invalid Provider\";\n    return { errors, isValid: Object.keys(errors).length === 0 };\n  }\n\n  const selectedProvider = paymentProviders[provider];\n  const selectedParams = params || {};\n\n  // set default values\n  // if (!selectedParams.selectedCurrency) [selectedParams.selectedCurrency] = selectedProvider.validCurrencies\n  // if (!selectedParams.fiatValue) selectedParams.fiatValue = selectedProvider.minOrderValue\n  // if (!selectedParams.selectedCryptoCurrency) [selectedParams.selectedCryptoCurrency] = selectedProvider.validCryptoCurrencies\n\n  // validations\n  if (selectedParams.fiatValue) {\n    const requestedOrderAmount = +parseFloat(selectedParams.fiatValue.toString()) || 0;\n    if (requestedOrderAmount < selectedProvider.minOrderValue) errors.fiatValue = \"Requested amount is lower than supported\";\n    if (requestedOrderAmount > selectedProvider.maxOrderValue && selectedProvider.enforceMax)\n      errors.fiatValue = \"Requested amount is higher than supported\";\n  }\n  if (selectedParams.selectedCurrency && !selectedProvider.validCurrencies.includes(selectedParams.selectedCurrency)) {\n    errors.selectedCurrency = \"Unsupported currency\";\n  }\n  if (selectedParams.selectedCryptoCurrency && !selectedProvider.validCryptoCurrencies.includes(selectedParams.selectedCryptoCurrency)) {\n    errors.selectedCryptoCurrency = \"Unsupported cryptoCurrency\";\n  }\n  return { errors, isValid: Object.keys(errors).length === 0 };\n};\n\n// utility functions\n\n/**\n * json-rpc-engine middleware that logs RPC errors and and validates req.method.\n *\n * @param log - The logging API to use.\n * @returns  json-rpc-engine middleware function\n */\nexport function createErrorMiddleware(): JRPCMiddleware<unknown, unknown> {\n  return (req, res, next) => {\n    // json-rpc-engine will terminate the request when it notices this error\n    if (typeof req.method !== \"string\" || !req.method) {\n      res.error = ethErrors.rpc.invalidRequest({\n        message: `The request 'method' must be a non-empty string.`,\n        data: req,\n      });\n    }\n\n    next((done) => {\n      const { error } = res;\n      if (!error) {\n        return done();\n      }\n      log.error(`MetaMask - RPC Error: ${error.message}`, error);\n      return done();\n    });\n  };\n}\n\n// resolve response.result or response, reject errors\nexport const getRpcPromiseCallback =\n  (resolve: (value?: any) => void, reject: (error?: Error) => void, unwrapResult = true) =>\n  (error: Error, response: PendingJRPCResponse<unknown>): void => {\n    if (error || response.error) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      reject(error || response.error);\n    } else {\n      resolve(!unwrapResult || Array.isArray(response) ? response : response.result);\n    }\n  };\n\n/**\n * Logs a stream disconnection error. Emits an 'error' if given an\n * EventEmitter that has listeners for the 'error' event.\n *\n * @param log - The logging API to use.\n * @param remoteLabel - The label of the disconnected stream.\n * @param error - The associated error to log.\n * @param emitter - The logging API to use.\n */\nexport function logStreamDisconnectWarning(remoteLabel: string, error: Error, emitter: SafeEventEmitter): void {\n  let warningMsg = `MetaMask: Lost connection to \"${remoteLabel}\".`;\n  if (error?.stack) {\n    warningMsg += `\\n${error.stack}`;\n  }\n  log.warn(warningMsg);\n  if (emitter && emitter.listenerCount(\"error\") > 0) {\n    emitter.emit(\"error\", warningMsg);\n  }\n}\n\nexport const getPreopenInstanceId = () => Math.random().toString(36).slice(2);\n\nexport const getTorusUrl = async (buildEnv: string, integrity: IntegrityParams): Promise<{ torusUrl: string; logLevel: LogLevelDesc }> => {\n  let torusUrl: string;\n  let logLevel: LogLevelDesc;\n  // Do not change this line\n  const version = process.env.TORUS_EMBED_VERSION;\n  let versionUsed = integrity.version || version;\n  try {\n    if ((buildEnv === \"binance\" || buildEnv === \"production\") && !integrity.version) {\n      let response: { data: string };\n      if (!config.prodTorusUrl)\n        response = await get(`${config.api}/latestversion?name=@toruslabs/torus-embed&version=${version}`, {}, { useAPIKey: true });\n      else response = { data: config.prodTorusUrl };\n      versionUsed = response.data;\n      // eslint-disable-next-line require-atomic-updates\n      config.prodTorusUrl = response.data;\n    }\n  } catch (error) {\n    log.error(error, \"unable to fetch latest version\");\n  }\n  log.info(\"version used: \", versionUsed);\n  switch (buildEnv) {\n    case \"binance\":\n      torusUrl = `https://binance.tor.us/v${versionUsed}`;\n      logLevel = \"info\";\n      break;\n    case \"testing\":\n      torusUrl = \"https://testing.tor.us\";\n      logLevel = \"debug\";\n      break;\n    case \"lrc\":\n      torusUrl = \"https://lrc.tor.us\";\n      logLevel = \"debug\";\n      break;\n    case \"beta\":\n      torusUrl = \"https://beta.tor.us\";\n      logLevel = \"debug\";\n      break;\n    case \"development\":\n      torusUrl = \"http://localhost:4050\";\n      logLevel = \"debug\";\n      break;\n    default:\n      torusUrl = `https://app.tor.us/v${versionUsed}`;\n      logLevel = \"error\";\n      break;\n  }\n  return { torusUrl, logLevel };\n};\n\nexport const getUserLanguage = (): string => {\n  let userLanguage = window.navigator.language || \"en-US\";\n  const userLanguages = userLanguage.split(\"-\");\n  userLanguage = Object.prototype.hasOwnProperty.call(config.translations, userLanguages[0]) ? userLanguages[0] : \"en\";\n  return userLanguage;\n};\n\nexport const EMITTED_NOTIFICATIONS = [\n  \"eth_subscription\", // per eth-json-rpc-filters/subscriptionManager\n];\n\nexport const NOOP = (): void => {\n  // empty function\n};\n\nexport const FEATURES_PROVIDER_CHANGE_WINDOW = \"directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=660,width=375\";\nexport const FEATURES_DEFAULT_WALLET_WINDOW = \"directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=740,width=1315\";\nexport const FEATURES_DEFAULT_POPUP_WINDOW = \"directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=700,width=1200\";\nexport const FEATURES_CONFIRM_WINDOW = \"directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=700,width=450\";\n\nexport function storageAvailable(type: \"localStorage\" | \"sessionStorage\"): boolean {\n  let storage: Storage;\n  try {\n    storage = window[type];\n    const x = \"__storage_test__\";\n    storage.setItem(x, x);\n    storage.removeItem(x);\n    return true;\n  } catch (e) {\n    return (\n      e &&\n      // everything except Firefox\n      (e.code === 22 ||\n        // Firefox\n        e.code === 1014 ||\n        // test name field too, because code might not be present\n        // everything except Firefox\n        e.name === \"QuotaExceededError\" ||\n        // Firefox\n        e.name === \"NS_ERROR_DOM_QUOTA_REACHED\") &&\n      // acknowledge QuotaExceededError only if there's something already stored\n      storage &&\n      storage.length !== 0\n    );\n  }\n}\n\nexport function getPopupFeatures(): string {\n  // Fixes dual-screen position                             Most browsers      Firefox\n  const dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screenX;\n  const dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;\n\n  const w = 1200;\n  const h = 700;\n\n  const width = window.innerWidth\n    ? window.innerWidth\n    : document.documentElement.clientWidth\n    ? document.documentElement.clientWidth\n    : window.screen.width;\n\n  const height = window.innerHeight\n    ? window.innerHeight\n    : document.documentElement.clientHeight\n    ? document.documentElement.clientHeight\n    : window.screen.height;\n\n  const systemZoom = 1; // No reliable estimate\n\n  const left = Math.abs((width - w) / 2 / systemZoom + dualScreenLeft);\n  const top = Math.abs((height - h) / 2 / systemZoom + dualScreenTop);\n  const features = `titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${h / systemZoom},width=${w / systemZoom},top=${top},left=${left}`;\n  return features;\n}\n","import { ObservableStore, storeAsStream } from \"@metamask/obs-store\";\nimport {\n  createIdRemapMiddleware,\n  createStreamMiddleware,\n  JRPCEngine,\n  JRPCRequest,\n  JRPCResponse,\n  JRPCSuccess,\n  ObjectMultiplex,\n  SafeEventEmitter,\n} from \"@toruslabs/openlogin-jrpc\";\nimport { EthereumRpcError, ethErrors } from \"eth-rpc-errors\";\nimport dequal from \"fast-deep-equal\";\nimport { isDuplexStream } from \"is-stream\";\nimport pump from \"pump\";\nimport type { Duplex } from \"readable-stream\";\n\nimport {\n  BaseProviderState,\n  JsonRpcConnection,\n  Maybe,\n  ProviderOptions,\n  PublicConfigState,\n  RequestArguments,\n  SendSyncJsonRpcRequest,\n  SentWarningsState,\n  UnvalidatedJsonRpcRequest,\n  WalletProviderState,\n} from \"./interfaces\";\nimport log from \"./loglevel\";\nimport messages from \"./messages\";\nimport { createErrorMiddleware, EMITTED_NOTIFICATIONS, logStreamDisconnectWarning, NOOP } from \"./utils\";\n\nSafeEventEmitter.defaultMaxListeners = 100;\n\n// resolve response.result, reject errors\nconst getRpcPromiseCallback =\n  (resolve, reject, unwrapResult = true) =>\n  (error, response) => {\n    if (error || response.error) {\n      return reject(error || response.error);\n    }\n    return !unwrapResult || Array.isArray(response) ? resolve(response) : resolve(response.result);\n  };\n\nclass TorusInpageProvider extends SafeEventEmitter {\n  protected static _defaultState: BaseProviderState = {\n    accounts: null,\n    isConnected: false,\n    isUnlocked: false,\n    initialized: false,\n    isPermanentlyDisconnected: false,\n    hasEmittedConnection: false,\n  };\n\n  /**\n   * The chain ID of the currently connected Ethereum chain.\n   * See [chainId.network]{@link https://chainid.network} for more information.\n   */\n  public chainId: string | null;\n\n  /**\n   * The user's currently selected Ethereum address.\n   * If null, MetaMask is either locked or the user has not permitted any\n   * addresses to be viewed.\n   */\n  public selectedAddress: string | null;\n\n  _rpcEngine: JRPCEngine;\n\n  public networkVersion: string | null;\n\n  shouldSendMetadata: boolean;\n\n  /**\n   * Indicating that this provider is a MetaMask provider.\n   */\n  public readonly isTorus: true;\n\n  _publicConfigStore: ObservableStore<PublicConfigState>;\n\n  tryPreopenHandle: (payload: UnvalidatedJsonRpcRequest | UnvalidatedJsonRpcRequest[], cb: (...args: unknown[]) => void) => void;\n\n  enable: () => Promise<string[]>;\n\n  protected _state: BaseProviderState;\n\n  protected _jsonRpcConnection: JsonRpcConnection;\n\n  protected _sentWarnings: SentWarningsState = {\n    // methods\n    enable: false,\n    experimentalMethods: false,\n    send: false,\n    publicConfigStore: false,\n    // events\n    events: {\n      close: false,\n      data: false,\n      networkChanged: false,\n      notification: false,\n    },\n  };\n\n  constructor(\n    connectionStream: Duplex,\n    { maxEventListeners = 100, shouldSendMetadata = true, jsonRpcStreamName = \"provider\" }: ProviderOptions = {}\n  ) {\n    super();\n    if (!isDuplexStream(connectionStream)) {\n      throw new Error(messages.errors.invalidDuplexStream());\n    }\n    this.isTorus = true;\n    this.setMaxListeners(maxEventListeners);\n\n    // private state\n    this._state = {\n      ...TorusInpageProvider._defaultState,\n    };\n\n    // public state\n    this.selectedAddress = null;\n    this.networkVersion = null;\n    this.chainId = null;\n    this.shouldSendMetadata = shouldSendMetadata;\n\n    // bind functions (to prevent e.g. web3@1.x from making unbound calls)\n    this._handleAccountsChanged = this._handleAccountsChanged.bind(this);\n    this._handleChainChanged = this._handleChainChanged.bind(this);\n    this._handleUnlockStateChanged = this._handleUnlockStateChanged.bind(this);\n    this._handleConnect = this._handleConnect.bind(this);\n    this._handleDisconnect = this._handleDisconnect.bind(this);\n    this._handleStreamDisconnect = this._handleStreamDisconnect.bind(this);\n    this._sendSync = this._sendSync.bind(this);\n    this._rpcRequest = this._rpcRequest.bind(this);\n    this._warnOfDeprecation = this._warnOfDeprecation.bind(this);\n    this._initializeState = this._initializeState.bind(this);\n\n    this.request = this.request.bind(this);\n    this.send = this.send.bind(this);\n    this.sendAsync = this.sendAsync.bind(this);\n    // this.enable = this.enable.bind(this);\n\n    // setup connectionStream multiplexing\n    const mux = new ObjectMultiplex();\n    pump(connectionStream, mux, connectionStream, this._handleStreamDisconnect.bind(this, \"MetaMask\"));\n\n    // subscribe to metamask public config (one-way)\n    this._publicConfigStore = new ObservableStore({ storageKey: \"Metamask-Config\" });\n\n    // handle isUnlocked changes, and chainChanged and networkChanged events\n    // this._publicConfigStore.subscribe((stringifiedState) => {\n    //   // This is because we are using store as string\n    //   const state = JSON.parse(stringifiedState as unknown as string);\n    //   if (\"isUnlocked\" in state && state.isUnlocked !== this._state.isUnlocked) {\n    //     this._state.isUnlocked = state.isUnlocked;\n    //     if (!this._state.isUnlocked) {\n    //       // accounts are never exposed when the extension is locked\n    //       this._handleAccountsChanged([]);\n    //     } else {\n    //       // this will get the exposed accounts, if any\n    //       try {\n    //         this._rpcRequest(\n    //           { method: \"eth_accounts\", params: [] },\n    //           NOOP,\n    //           true // indicating that eth_accounts _should_ update accounts\n    //         );\n    //       } catch (_) {\n    //         // Swallow error\n    //       }\n    //     }\n    //   }\n\n    //   if (\"selectedAddress\" in state && this.selectedAddress !== state.selectedAddress) {\n    //     try {\n    //       this._rpcRequest(\n    //         { method: \"eth_accounts\", params: [] },\n    //         NOOP,\n    //         true // indicating that eth_accounts _should_ update accounts\n    //       );\n    //     } catch (_) {\n    //       // Swallow error\n    //     }\n    //   }\n\n    //   // Emit chainChanged event on chain change\n    //   if (\"chainId\" in state && state.chainId !== this.chainId) {\n    //     this.chainId = state.chainId || null;\n    //     this.emit(\"chainChanged\", this.chainId);\n\n    //     // indicate that we've connected, for EIP-1193 compliance\n    //     // we do this here so that iframe can initialize\n    //     if (!this._state.hasEmittedConnection) {\n    //       this._handleConnect(this.chainId);\n    //       this._state.hasEmittedConnection = true;\n    //     }\n    //   }\n\n    //   // Emit networkChanged event on network change\n    //   if (\"networkVersion\" in state && state.networkVersion !== this.networkVersion) {\n    //     this.networkVersion = state.networkVersion || null;\n    //     this.emit(\"networkChanged\", this.networkVersion);\n    //   }\n    // });\n\n    pump(\n      mux.createStream(\"publicConfig\") as unknown as Duplex,\n      storeAsStream(this._publicConfigStore),\n      // RPC requests should still work if only this stream fails\n      logStreamDisconnectWarning.bind(this, \"MetaMask PublicConfigStore\")\n    );\n    // ignore phishing warning message (handled elsewhere)\n    mux.ignoreStream(\"phishing\");\n\n    // setup own event listeners\n\n    // EIP-1193 connect\n    this.on(\"connect\", () => {\n      this._state.isConnected = true;\n    });\n\n    // connect to async provider\n\n    const jsonRpcConnection = createStreamMiddleware();\n    pump(\n      jsonRpcConnection.stream,\n      mux.createStream(jsonRpcStreamName) as unknown as Duplex,\n      jsonRpcConnection.stream,\n      this._handleStreamDisconnect.bind(this, \"MetaMask RpcProvider\")\n    );\n\n    // handle RPC requests via dapp-side rpc engine\n    const rpcEngine = new JRPCEngine();\n    rpcEngine.push(createIdRemapMiddleware());\n    rpcEngine.push(createErrorMiddleware());\n    rpcEngine.push(jsonRpcConnection.middleware);\n    this._rpcEngine = rpcEngine;\n\n    // json rpc notification listener\n    jsonRpcConnection.events.on(\"notification\", (payload) => {\n      const { method, params } = payload;\n      if (method === \"wallet_accountsChanged\") {\n        this._handleAccountsChanged(params);\n      } else if (method === \"wallet_unlockStateChanged\") {\n        this._handleUnlockStateChanged(params);\n      } else if (method === \"wallet_chainChanged\") {\n        this._handleChainChanged(params);\n      } else if (EMITTED_NOTIFICATIONS.includes(payload.method)) {\n        // EIP 1193 subscriptions, per eth-json-rpc-filters/subscriptionManager\n        this.emit(\"data\", payload); // deprecated\n        this.emit(\"notification\", params.result);\n        this.emit(\"message\", {\n          type: method,\n          data: params,\n        });\n      }\n\n      // Backward compatibility for older non EIP 1193 subscriptions\n      // this.emit('data', null, payload)\n    });\n  }\n\n  get publicConfigStore(): ObservableStore<PublicConfigState> {\n    if (!this._sentWarnings.publicConfigStore) {\n      log.warn(messages.warnings.publicConfigStore);\n      this._sentWarnings.publicConfigStore = true;\n    }\n    return this._publicConfigStore;\n  }\n\n  /**\n   * Returns whether the inpage provider is connected to Torus.\n   */\n  isConnected(): boolean {\n    return this._state.isConnected;\n  }\n\n  /**\n   * Submits an RPC request for the given method, with the given params.\n   * Resolves with the result of the method call, or rejects on error.\n   *\n   * @param args - The RPC request arguments.\n   * @returns A Promise that resolves with the result of the RPC method,\n   * or rejects if an error is encountered.\n   */\n  async request<T>(args: RequestArguments): Promise<Maybe<T>> {\n    if (!args || typeof args !== \"object\" || Array.isArray(args)) {\n      throw ethErrors.rpc.invalidRequest({\n        message: messages.errors.invalidRequestArgs(),\n        data: args,\n      });\n    }\n\n    const { method, params } = args;\n\n    if (typeof method !== \"string\" || method.length === 0) {\n      throw ethErrors.rpc.invalidRequest({\n        message: messages.errors.invalidRequestMethod(),\n        data: args,\n      });\n    }\n\n    if (params !== undefined && !Array.isArray(params) && (typeof params !== \"object\" || params === null)) {\n      throw ethErrors.rpc.invalidRequest({\n        message: messages.errors.invalidRequestParams(),\n        data: args,\n      });\n    }\n\n    return new Promise((resolve, reject) => {\n      this._rpcRequest({ method, params }, getRpcPromiseCallback(resolve, reject));\n    });\n  }\n\n  /**\n   * Submits an RPC request per the given JSON-RPC request object.\n   *\n   * @param payload - The RPC request object.\n   * @param cb - The callback function.\n   */\n  sendAsync(payload: JRPCRequest<unknown>, callback: (error: Error | null, result?: JRPCResponse<unknown>) => void): void {\n    this._rpcRequest(payload, callback);\n  }\n\n  /**\n   * We override the following event methods so that we can warn consumers\n   * about deprecated events:\n   *   addListener, on, once, prependListener, prependOnceListener\n   */\n\n  addListener(eventName: string, listener: (...args: unknown[]) => void): this {\n    this._warnOfDeprecation(eventName);\n    return super.addListener(eventName, listener);\n  }\n\n  on(eventName: string, listener: (...args: unknown[]) => void): this {\n    this._warnOfDeprecation(eventName);\n    return super.on(eventName, listener);\n  }\n\n  once(eventName: string, listener: (...args: unknown[]) => void): this {\n    this._warnOfDeprecation(eventName);\n    return super.once(eventName, listener);\n  }\n\n  prependListener(eventName: string, listener: (...args: unknown[]) => void): this {\n    this._warnOfDeprecation(eventName);\n    return super.prependListener(eventName, listener);\n  }\n\n  prependOnceListener(eventName: string, listener: (...args: unknown[]) => void): this {\n    this._warnOfDeprecation(eventName);\n    return super.prependOnceListener(eventName, listener);\n  }\n\n  // Private Methods\n  //= ===================\n  /**\n   * Constructor helper.\n   * Populates initial state by calling 'wallet_getProviderState' and emits\n   * necessary events.\n   */\n  async _initializeState(): Promise<void> {\n    try {\n      const { accounts, chainId, isUnlocked, networkVersion } = (await this.request({\n        method: \"wallet_getProviderState\",\n      })) as WalletProviderState;\n\n      // indicate that we've connected, for EIP-1193 compliance\n      this.emit(\"connect\", { chainId });\n\n      this._handleChainChanged({ chainId, networkVersion });\n      this._handleUnlockStateChanged({ accounts, isUnlocked });\n      this._handleAccountsChanged(accounts);\n    } catch (error) {\n      log.error(\"MetaMask: Failed to get initial state. Please report this bug.\", error);\n    } finally {\n      log.info(\"initialized state\");\n      this._state.initialized = true;\n      this.emit(\"_initialized\");\n    }\n  }\n\n  /**\n   * Internal RPC method. Forwards requests to background via the RPC engine.\n   * Also remap ids inbound and outbound.\n   *\n   * @param payload - The RPC request object.\n   * @param callback - The consumer's callback.\n   * @param isInternal - false - Whether the request is internal.\n   */\n  _rpcRequest(payload: UnvalidatedJsonRpcRequest | UnvalidatedJsonRpcRequest[], callback: (...args: any[]) => void, isInternal = false): void {\n    let cb = callback;\n    const _payload = payload;\n    if (!Array.isArray(_payload)) {\n      if (!_payload.jsonrpc) {\n        _payload.jsonrpc = \"2.0\";\n      }\n\n      if (_payload.method === \"eth_accounts\" || _payload.method === \"eth_requestAccounts\") {\n        // handle accounts changing\n        cb = (err: Error, res: JRPCSuccess<string[]>) => {\n          this._handleAccountsChanged(res.result || [], _payload.method === \"eth_accounts\", isInternal);\n          callback(err, res);\n        };\n      } else if (_payload.method === \"wallet_getProviderState\") {\n        this._rpcEngine.handle(payload as JRPCRequest<unknown>, cb);\n        return;\n      }\n    }\n    this.tryPreopenHandle(_payload, cb);\n  }\n\n  /**\n   * Submits an RPC request for the given method, with the given params.\n   *\n   * @deprecated Use \"request\" instead.\n   * @param method - The method to request.\n   * @param params - Any params for the method.\n   * @returns A Promise that resolves with the JSON-RPC response object for the\n   * request.\n   */\n  send<T>(method: string, params?: T[]): Promise<JRPCResponse<T>>;\n\n  /**\n   * Submits an RPC request per the given JSON-RPC request object.\n   *\n   * @deprecated Use \"request\" instead.\n   * @param payload - A JSON-RPC request object.\n   * @param callback - An error-first callback that will receive the JSON-RPC\n   * response object.\n   */\n  send<T>(payload: JRPCRequest<unknown>, callback: (error: Error | null, result?: JRPCResponse<T>) => void): void;\n\n  /**\n   * Accepts a JSON-RPC request object, and synchronously returns the cached result\n   * for the given method. Only supports 4 specific RPC methods.\n   *\n   * @deprecated Use \"request\" instead.\n   * @param payload - A JSON-RPC request object.\n   * @returns A JSON-RPC response object.\n   */\n  send<T>(payload: SendSyncJsonRpcRequest): JRPCResponse<T>;\n\n  send(methodOrPayload: unknown, callbackOrArgs?: unknown): unknown {\n    if (!this._sentWarnings.send) {\n      log.warn(messages.warnings.sendDeprecation);\n      this._sentWarnings.send = true;\n    }\n    if (typeof methodOrPayload === \"string\" && (!callbackOrArgs || Array.isArray(callbackOrArgs))) {\n      return new Promise((resolve, reject) => {\n        try {\n          this._rpcRequest({ method: methodOrPayload, params: callbackOrArgs }, getRpcPromiseCallback(resolve, reject, false));\n        } catch (error) {\n          reject(error);\n        }\n      });\n    }\n    if (methodOrPayload && typeof methodOrPayload === \"object\" && typeof callbackOrArgs === \"function\") {\n      return this._rpcRequest(methodOrPayload as JRPCRequest<unknown>, callbackOrArgs as (...args: unknown[]) => void);\n    }\n    return this._sendSync(methodOrPayload as SendSyncJsonRpcRequest);\n  }\n\n  /**\n   * DEPRECATED.\n   * Internal backwards compatibility method, used in send.\n   */\n  _sendSync(payload: SendSyncJsonRpcRequest): JRPCSuccess<unknown> {\n    let result;\n    switch (payload.method) {\n      case \"eth_accounts\":\n        result = this.selectedAddress ? [this.selectedAddress] : [];\n        break;\n\n      case \"eth_coinbase\":\n        result = this.selectedAddress || null;\n        break;\n\n      case \"eth_uninstallFilter\":\n        this._rpcRequest(payload, NOOP);\n        result = true;\n        break;\n\n      case \"net_version\":\n        result = this.networkVersion || null;\n        break;\n\n      default:\n        throw new Error(messages.errors.unsupportedSync(payload.method));\n    }\n\n    return {\n      id: payload.id,\n      jsonrpc: payload.jsonrpc,\n      result,\n    };\n  }\n\n  /**\n   * When the provider becomes connected, updates internal state and emits\n   * required events. Idempotent.\n   *\n   * @param chainId - The ID of the newly connected chain.\n   * emits MetaMaskInpageProvider#connect\n   */\n  protected _handleConnect(chainId: string): void {\n    if (!this._state.isConnected) {\n      this._state.isConnected = true;\n      this.emit(\"connect\", { chainId });\n      log.debug(messages.info.connected(chainId));\n    }\n  }\n\n  /**\n   * When the provider becomes disconnected, updates internal state and emits\n   * required events. Idempotent with respect to the isRecoverable parameter.\n   *\n   * Error codes per the CloseEvent status codes as required by EIP-1193:\n   * https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent#Status_codes\n   *\n   * @param isRecoverable - Whether the disconnection is recoverable.\n   * @param errorMessage - A custom error message.\n   * emits MetaMaskInpageProvider#disconnect\n   */\n  protected _handleDisconnect(isRecoverable: boolean, errorMessage?: string): void {\n    if (this._state.isConnected || (!this._state.isPermanentlyDisconnected && !isRecoverable)) {\n      this._state.isConnected = false;\n\n      let error;\n      if (isRecoverable) {\n        error = new EthereumRpcError(\n          1013, // Try again later\n          errorMessage || messages.errors.disconnected()\n        );\n        log.debug(error);\n      } else {\n        error = new EthereumRpcError(\n          1011, // Internal error\n          errorMessage || messages.errors.permanentlyDisconnected()\n        );\n        log.error(error);\n        this.chainId = null;\n        this._state.accounts = null;\n        this.selectedAddress = null;\n        this._state.isUnlocked = false;\n        this._state.isPermanentlyDisconnected = true;\n      }\n\n      this.emit(\"disconnect\", error);\n    }\n  }\n\n  /**\n   * Called when connection is lost to critical streams.\n   *\n   * emits MetamaskInpageProvider#disconnect\n   */\n  protected _handleStreamDisconnect(streamName: string, error: Error): void {\n    logStreamDisconnectWarning(streamName, error, this);\n    this._handleDisconnect(false, error ? error.message : undefined);\n  }\n\n  /**\n   * Called when accounts may have changed.\n   */\n  protected _handleAccountsChanged(accounts: unknown[], isEthAccounts = false, isInternal = false): void {\n    // defensive programming\n    let finalAccounts = accounts;\n    if (!Array.isArray(finalAccounts)) {\n      log.error(\"MetaMask: Received non-array accounts parameter. Please report this bug.\", finalAccounts);\n      finalAccounts = [];\n    }\n\n    for (const account of accounts) {\n      if (typeof account !== \"string\") {\n        log.error(\"MetaMask: Received non-string account. Please report this bug.\", accounts);\n        finalAccounts = [];\n        break;\n      }\n    }\n\n    // emit accountsChanged if anything about the accounts array has changed\n    if (!dequal(this._state.accounts, finalAccounts)) {\n      // we should always have the correct accounts even before eth_accounts\n      // returns, except in cases where isInternal is true\n      if (isEthAccounts && Array.isArray(this._state.accounts) && this._state.accounts.length > 0 && !isInternal) {\n        log.error('MetaMask: \"eth_accounts\" unexpectedly updated accounts. Please report this bug.', finalAccounts);\n      }\n\n      this._state.accounts = finalAccounts as string[];\n      this.emit(\"accountsChanged\", finalAccounts);\n    }\n\n    // handle selectedAddress\n    if (this.selectedAddress !== finalAccounts[0]) {\n      this.selectedAddress = (finalAccounts[0] as string) || null;\n    }\n  }\n\n  /**\n   * Upon receipt of a new chainId and networkVersion, emits corresponding\n   * events and sets relevant public state.\n   * Does nothing if neither the chainId nor the networkVersion are different\n   * from existing values.\n   *\n   * emits MetamaskInpageProvider#chainChanged\n   * @param networkInfo - An object with network info.\n   */\n  protected _handleChainChanged({ chainId, networkVersion }: { chainId?: string; networkVersion?: string } = {}): void {\n    if (!chainId || !networkVersion) {\n      log.error(\"MetaMask: Received invalid network parameters. Please report this bug.\", { chainId, networkVersion });\n      return;\n    }\n\n    if (networkVersion === \"loading\") {\n      this._handleDisconnect(true);\n    } else {\n      this._handleConnect(chainId);\n\n      if (chainId !== this.chainId) {\n        this.chainId = chainId;\n        if (this._state.initialized) {\n          this.emit(\"chainChanged\", this.chainId);\n        }\n      }\n    }\n  }\n\n  /**\n   * Upon receipt of a new isUnlocked state, sets relevant public state.\n   * Calls the accounts changed handler with the received accounts, or an empty\n   * array.\n   *\n   * Does nothing if the received value is equal to the existing value.\n   * There are no lock/unlock events.\n   *\n   * @param opts - Options bag.\n   */\n  protected _handleUnlockStateChanged({ accounts, isUnlocked }: { accounts?: string[]; isUnlocked?: boolean } = {}): void {\n    if (typeof isUnlocked !== \"boolean\") {\n      log.error(\"MetaMask: Received invalid isUnlocked parameter. Please report this bug.\", { isUnlocked });\n      return;\n    }\n\n    if (isUnlocked !== this._state.isUnlocked) {\n      this._state.isUnlocked = isUnlocked;\n      this._handleAccountsChanged(accounts || []);\n    }\n  }\n\n  /**\n   * Warns of deprecation for the given event, if applicable.\n   */\n  protected _warnOfDeprecation(eventName: string): void {\n    if (this._sentWarnings.events[eventName] === false) {\n      log.warn(messages.warnings.events[eventName]);\n      this._sentWarnings.events[eventName] = true;\n    }\n  }\n}\n\nexport default TorusInpageProvider;\n","import createHash from \"create-hash\";\n\nimport { IHashAlgorithmOptions, SRI } from \"./interfaces\";\n\nconst defaults = (options: IHashAlgorithmOptions) => ({\n  algorithms: options.algorithms || [\"sha256\"],\n  delimiter: options.delimiter || \" \",\n  full: options.full || false,\n});\n\n// Generate list of hashes\nconst hashes = (options: IHashAlgorithmOptions, data: string): Record<createHash.algorithm, string> => {\n  const internalHashes: Record<string, string> = {};\n  options.algorithms.forEach((algorithm) => {\n    internalHashes[algorithm] = createHash(algorithm).update(data, \"utf8\").digest(\"base64\");\n  });\n  return internalHashes;\n};\n// Build an integrity string\nconst integrity = (options: IHashAlgorithmOptions, sri: SRI): string => {\n  let output = \"\";\n\n  // Hash list\n  output += Object.keys(sri.hashes)\n    .map((algorithm: createHash.algorithm) => `${algorithm}-${sri.hashes[algorithm]}`)\n    .join(options.delimiter);\n\n  return output;\n};\n\nconst main = (options: IHashAlgorithmOptions, data: string): SRI | string => {\n  // Defaults\n  const finalOptions = defaults(options);\n\n  const sri = {\n    hashes: hashes(finalOptions, data),\n    integrity: undefined,\n  };\n  sri.integrity = integrity(finalOptions, sri);\n\n  return finalOptions.full ? sri : sri.integrity;\n};\n\nexport default main;\n","import { EventEmitter } from \"events\";\n\nimport { getPopupFeatures } from \"./utils\";\n\nclass PopupHandler extends EventEmitter {\n  url: URL;\n\n  target: string;\n\n  features: string;\n\n  window: Window;\n\n  windowTimer: number;\n\n  iClosedWindow: boolean;\n\n  constructor({ url, target, features }: { url: URL; target?: string; features?: string }) {\n    super();\n    this.url = url;\n    this.target = target || \"_blank\";\n    this.features = features || getPopupFeatures();\n    this.window = undefined;\n    this.windowTimer = undefined;\n    this.iClosedWindow = false;\n    this._setupTimer();\n  }\n\n  _setupTimer(): void {\n    this.windowTimer = Number(\n      setInterval(() => {\n        if (this.window && this.window.closed) {\n          clearInterval(this.windowTimer);\n          if (!this.iClosedWindow) {\n            this.emit(\"close\");\n          }\n          this.iClosedWindow = false;\n          this.window = undefined;\n        }\n        if (this.window === undefined) clearInterval(this.windowTimer);\n      }, 500)\n    );\n  }\n\n  open(): Promise<void> {\n    this.window = window.open(this.url.href, this.target, this.features);\n    if (this.window?.focus) this.window.focus();\n    return Promise.resolve();\n  }\n\n  close(): void {\n    this.iClosedWindow = true;\n    if (this.window) this.window.close();\n  }\n\n  redirect(locationReplaceOnRedirect: boolean): void {\n    if (locationReplaceOnRedirect) {\n      window.location.replace(this.url.href);\n    } else {\n      window.location.href = this.url.href;\n    }\n  }\n}\n\nexport default PopupHandler;\n","import { JRPCEngine } from \"@toruslabs/openlogin-jrpc\";\n\nimport log from \"./loglevel\";\nimport messages from \"./messages\";\nimport { getPreopenInstanceId, NOOP } from \"./utils\";\n\n/**\n * Returns whether the given image URL exists\n * @param url - the url of the image\n * @returns - whether the image exists\n */\nfunction imgExists(url: string): Promise<boolean> {\n  return new Promise((resolve, reject) => {\n    try {\n      const img = document.createElement(\"img\");\n      img.onload = () => resolve(true);\n      img.onerror = () => resolve(false);\n      img.src = url;\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n\n/**\n * Extracts a name for the site from the DOM\n */\nconst getSiteName = (window: Window) => {\n  const { document } = window;\n\n  const siteName = document.querySelector<HTMLMetaElement>('head > meta[property=\"og:site_name\"]');\n  if (siteName) {\n    return siteName.content;\n  }\n\n  const metaTitle = document.querySelector<HTMLMetaElement>('head > meta[name=\"title\"]');\n  if (metaTitle) {\n    return metaTitle.content;\n  }\n\n  if (document.title && document.title.length > 0) {\n    return document.title;\n  }\n\n  return window.location.hostname;\n};\n\n/**\n * Extracts an icon for the site from the DOM\n */\nasync function getSiteIcon(window: Window): Promise<string | null> {\n  const { document } = window;\n\n  // Use the site's favicon if it exists\n  let icon = document.querySelector<HTMLLinkElement>('head > link[rel=\"shortcut icon\"]');\n  if (icon && (await imgExists(icon.href))) {\n    return icon.href;\n  }\n\n  // Search through available icons in no particular order\n  icon = Array.from(document.querySelectorAll<HTMLLinkElement>('head > link[rel=\"icon\"]')).find((_icon) => Boolean(_icon.href));\n  if (icon && (await imgExists(icon.href))) {\n    return icon.href;\n  }\n\n  return null;\n}\n\n/**\n * Gets site metadata and returns it\n *\n */\nconst getSiteMetadata = async () => ({\n  name: getSiteName(window),\n  icon: await getSiteIcon(window),\n});\n\n/**\n * Sends site metadata over an RPC request.\n */\nexport default async function sendSiteMetadata(engine: JRPCEngine): Promise<void> {\n  try {\n    const domainMetadata = await getSiteMetadata();\n    // call engine.handle directly to avoid normal RPC request handling\n    engine.handle(\n      {\n        jsonrpc: \"2.0\",\n        id: getPreopenInstanceId(),\n        method: \"wallet_sendDomainMetadata\",\n        params: domainMetadata,\n      },\n      NOOP\n    );\n  } catch (error) {\n    log.error({\n      message: messages.errors.sendSiteMetadata(),\n      originalError: error,\n    });\n  }\n}\n","import NodeDetailManager from \"@toruslabs/fetch-node-details\";\nimport { setAPIKey } from \"@toruslabs/http-helpers\";\nimport { BasePostMessageStream, JRPCRequest, ObjectMultiplex, setupMultiplex, Substream } from \"@toruslabs/openlogin-jrpc\";\nimport TorusJs from \"@toruslabs/torus.js\";\nimport deepmerge from \"lodash.merge\";\n\nimport configuration from \"./config\";\nimport { documentReady, handleStream, htmlToElement, runOnLoad } from \"./embedUtils\";\nimport TorusInpageProvider from \"./inpage-provider\";\nimport generateIntegrity from \"./integrity\";\nimport {\n  BUTTON_POSITION,\n  BUTTON_POSITION_TYPE,\n  EMBED_TRANSLATION_ITEM,\n  LOGIN_PROVIDER,\n  PAYMENT_PROVIDER_TYPE,\n  PaymentParams,\n  TORUS_BUILD_ENV,\n  TorusCtorArgs,\n  TorusLoginParams,\n  TorusParams,\n  TorusPublicKey,\n  UnvalidatedJsonRpcRequest,\n  UserInfo,\n  VerifierArgs,\n  WALLET_OPENLOGIN_VERIFIER_MAP,\n  WALLET_PATH,\n  WhiteLabelParams,\n} from \"./interfaces\";\nimport log from \"./loglevel\";\nimport PopupHandler from \"./PopupHandler\";\nimport sendSiteMetadata from \"./siteMetadata\";\nimport {\n  FEATURES_CONFIRM_WINDOW,\n  FEATURES_DEFAULT_WALLET_WINDOW,\n  FEATURES_PROVIDER_CHANGE_WINDOW,\n  getPreopenInstanceId,\n  getTorusUrl,\n  getUserLanguage,\n  storageAvailable,\n  validatePaymentProvider,\n} from \"./utils\";\n\nconst defaultVerifiers = {\n  [LOGIN_PROVIDER.GOOGLE]: true,\n  [LOGIN_PROVIDER.FACEBOOK]: true,\n  [LOGIN_PROVIDER.REDDIT]: true,\n  [LOGIN_PROVIDER.TWITCH]: true,\n  [LOGIN_PROVIDER.DISCORD]: true,\n};\n\nconst iframeIntegrity = \"sha384-I1qqxsIO3trXzTO78PZoXvNamECKTo3uCnztKxjV0MmFWtmZY3uBpnJlhO7z/WBw\";\n\nconst expectedCacheControlHeader = \"max-age=3600\";\n\nconst UNSAFE_METHODS = [\n  \"eth_sendTransaction\",\n  \"eth_signTypedData\",\n  \"eth_signTypedData_v3\",\n  \"eth_signTypedData_v4\",\n  \"personal_sign\",\n  \"eth_getEncryptionPublicKey\",\n  \"eth_decrypt\",\n];\n\nconst isLocalStorageAvailable = storageAvailable(\"localStorage\");\n\n// preload for iframe doesn't work https://bugs.chromium.org/p/chromium/issues/detail?id=593267\n(async function preLoadIframe() {\n  try {\n    if (typeof document === \"undefined\") return;\n    const torusIframeHtml = document.createElement(\"link\");\n    const { torusUrl } = await getTorusUrl(\"production\", { check: false, hash: iframeIntegrity, version: \"\" });\n    torusIframeHtml.href = `${torusUrl}/popup`;\n    torusIframeHtml.crossOrigin = \"anonymous\";\n    torusIframeHtml.type = \"text/html\";\n    torusIframeHtml.rel = \"prefetch\";\n    if (torusIframeHtml.relList && torusIframeHtml.relList.supports) {\n      if (torusIframeHtml.relList.supports(\"prefetch\")) {\n        document.head.appendChild(torusIframeHtml);\n      }\n    }\n  } catch (error) {\n    log.warn(error);\n  }\n})();\n\nclass Torus {\n  buttonPosition: BUTTON_POSITION_TYPE = BUTTON_POSITION.BOTTOM_LEFT;\n\n  torusUrl: string;\n\n  torusIframe: HTMLIFrameElement;\n\n  styleLink: HTMLLinkElement;\n\n  isLoggedIn: boolean;\n\n  isInitialized: boolean;\n\n  torusWidgetVisibility: boolean;\n\n  torusAlert: HTMLDivElement;\n\n  nodeDetailManager: NodeDetailManager;\n\n  torusJs: TorusJs;\n\n  apiKey: string;\n\n  modalZIndex: number;\n\n  alertZIndex: number;\n\n  torusAlertContainer: HTMLDivElement;\n\n  isIframeFullScreen: boolean;\n\n  whiteLabel: WhiteLabelParams;\n\n  requestedVerifier: string;\n\n  currentVerifier: string;\n\n  embedTranslations: EMBED_TRANSLATION_ITEM;\n\n  ethereum: TorusInpageProvider;\n\n  provider: TorusInpageProvider;\n\n  communicationMux: ObjectMultiplex;\n\n  isLoginCallback: () => void;\n\n  dappStorageKey: string;\n\n  paymentProviders = configuration.paymentProviders;\n\n  private loginHint = \"\";\n\n  private useWalletConnect: boolean;\n\n  constructor({ buttonPosition = BUTTON_POSITION.BOTTOM_LEFT, modalZIndex = 99999, apiKey = \"torus-default\" }: TorusCtorArgs = {}) {\n    this.buttonPosition = buttonPosition;\n    this.torusUrl = \"\";\n    this.isLoggedIn = false; // ethereum.enable working\n    this.isInitialized = false; // init done\n    this.torusWidgetVisibility = true;\n    this.requestedVerifier = \"\";\n    this.currentVerifier = \"\";\n    this.nodeDetailManager = new NodeDetailManager();\n    this.torusJs = new TorusJs({\n      metadataHost: \"https://metadata.tor.us\",\n      allowHost: \"https://signer.tor.us/api/allow\",\n    });\n    this.apiKey = apiKey;\n    TorusJs.setAPIKey(apiKey);\n    setAPIKey(apiKey);\n    this.modalZIndex = modalZIndex;\n    this.alertZIndex = modalZIndex + 1000;\n    this.isIframeFullScreen = false;\n    this.dappStorageKey = \"\";\n  }\n\n  async init({\n    buildEnv = TORUS_BUILD_ENV.PRODUCTION,\n    enableLogging = false,\n    // deprecated: use loginConfig instead\n    enabledVerifiers = defaultVerifiers,\n    network = {\n      host: \"mainnet\",\n      chainId: null,\n      networkName: \"\",\n      blockExplorer: \"\",\n      ticker: \"\",\n      tickerName: \"\",\n    },\n    loginConfig = {},\n    showTorusButton = true,\n    integrity = {\n      check: false,\n      hash: iframeIntegrity,\n      version: \"\",\n    },\n    whiteLabel,\n    skipTKey = false,\n    useLocalStorage = false,\n    useWalletConnect = false,\n  }: TorusParams = {}): Promise<void> {\n    if (this.isInitialized) throw new Error(\"Already initialized\");\n    const { torusUrl, logLevel } = await getTorusUrl(buildEnv, integrity);\n    log.info(torusUrl, \"url loaded\");\n    this.torusUrl = torusUrl;\n    this.whiteLabel = whiteLabel;\n    this.useWalletConnect = useWalletConnect;\n    log.setDefaultLevel(logLevel);\n    if (enableLogging) log.enableAll();\n    else log.disableAll();\n    this.torusWidgetVisibility = showTorusButton;\n    let dappStorageKey = \"\";\n    if (isLocalStorageAvailable && useLocalStorage) {\n      const storedKey = window.localStorage.getItem(configuration.localStorageKey);\n      if (storedKey) dappStorageKey = storedKey;\n      else {\n        const generatedKey = `torus-app-${getPreopenInstanceId()}`;\n        window.localStorage.setItem(configuration.localStorageKey, generatedKey);\n        dappStorageKey = generatedKey;\n      }\n    }\n    this.dappStorageKey = dappStorageKey;\n    const torusIframeUrl = new URL(torusUrl);\n    if (torusIframeUrl.pathname.endsWith(\"/\")) torusIframeUrl.pathname += \"popup\";\n    else torusIframeUrl.pathname += \"/popup\";\n    if (dappStorageKey) {\n      torusIframeUrl.hash = `#dappStorageKey=${dappStorageKey}`;\n    }\n    // Iframe code\n    this.torusIframe = htmlToElement<HTMLIFrameElement>(\n      `<iframe\n        id=\"torusIframe\"\n        allow=${useWalletConnect ? \"camera\" : \"\"}\n        class=\"torusIframe\"\n        src=\"${torusIframeUrl.href}\"\n        style=\"display: none; position: fixed; top: 0; right: 0; width: 100%;\n        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex}\"\n      ></iframe>`\n    );\n\n    this.torusAlertContainer = htmlToElement<HTMLDivElement>('<div id=\"torusAlertContainer\"></div>');\n    this.torusAlertContainer.style.display = \"none\";\n    this.torusAlertContainer.style.setProperty(\"z-index\", this.alertZIndex.toString());\n\n    const link = window.document.createElement(\"link\");\n    link.setAttribute(\"rel\", \"stylesheet\");\n    link.setAttribute(\"type\", \"text/css\");\n    link.setAttribute(\"href\", `${torusUrl}/css/widget.css`);\n    this.styleLink = link;\n\n    const { defaultLanguage = getUserLanguage(), customTranslations = {} } = this.whiteLabel || {};\n    const mergedTranslations = deepmerge(configuration.translations, customTranslations);\n    const languageTranslations = mergedTranslations[defaultLanguage] || configuration.translations[getUserLanguage()];\n    this.embedTranslations = languageTranslations.embed;\n\n    const handleSetup = async () => {\n      await documentReady();\n      return new Promise((resolve, reject) => {\n        this.torusIframe.onload = async () => {\n          // only do this if iframe is not full screen\n          this._setupWeb3();\n          const initStream = this.communicationMux.getStream(\"init_stream\") as Substream;\n          initStream.on(\"data\", (chunk) => {\n            const { name, data, error } = chunk;\n            if (name === \"init_complete\" && data.success) {\n              // resolve promise\n              this.isInitialized = true;\n              this._displayIframe(this.isIframeFullScreen);\n              resolve(undefined);\n            } else if (error) {\n              reject(new Error(error));\n            }\n          });\n          initStream.write({\n            name: \"init_stream\",\n            data: {\n              enabledVerifiers,\n              loginConfig,\n              whiteLabel: this.whiteLabel,\n              buttonPosition: this.buttonPosition,\n              torusWidgetVisibility: this.torusWidgetVisibility,\n              apiKey: this.apiKey,\n              skipTKey,\n              network,\n            },\n          });\n        };\n        window.document.head.appendChild(this.styleLink);\n        window.document.body.appendChild(this.torusIframe);\n        window.document.body.appendChild(this.torusAlertContainer);\n      });\n    };\n\n    if (buildEnv === \"production\" && integrity.check) {\n      // hacky solution to check for iframe integrity\n      const fetchUrl = `${torusUrl}/popup`;\n      const resp = await fetch(fetchUrl, { cache: \"reload\" });\n      if (resp.headers.get(\"Cache-Control\") !== expectedCacheControlHeader) {\n        throw new Error(`Unexpected Cache-Control headers, got ${resp.headers.get(\"Cache-Control\")}`);\n      }\n      const response = await resp.text();\n      const calculatedIntegrity = generateIntegrity(\n        {\n          algorithms: [\"sha384\"],\n        },\n        response\n      );\n      log.info(calculatedIntegrity, \"integrity\");\n      if (calculatedIntegrity === integrity.hash) {\n        await handleSetup();\n      } else {\n        this.clearInit();\n        throw new Error(\"Integrity check failed\");\n      }\n    } else {\n      await handleSetup();\n    }\n    return undefined;\n  }\n\n  login({ verifier = \"\", login_hint: loginHint = \"\" }: TorusLoginParams = {}): Promise<string[]> {\n    if (!this.isInitialized) throw new Error(\"Call init() first\");\n    this.requestedVerifier = verifier;\n    this.loginHint = loginHint;\n    return this.ethereum.enable();\n  }\n\n  logout(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      if (!this.isLoggedIn) {\n        reject(new Error(\"User has not logged in yet\"));\n        return;\n      }\n\n      const logOutStream = this.communicationMux.getStream(\"logout\") as Substream;\n      logOutStream.write({ name: \"logOut\" });\n      const statusStream = this.communicationMux.getStream(\"status\") as Substream;\n      const statusStreamHandler = (status) => {\n        if (!status.loggedIn) {\n          this.isLoggedIn = false;\n          this.currentVerifier = \"\";\n          this.requestedVerifier = \"\";\n          resolve();\n        } else reject(new Error(\"Some Error Occured\"));\n      };\n      handleStream(statusStream, \"data\", statusStreamHandler);\n    });\n  }\n\n  async cleanUp(): Promise<void> {\n    if (this.isLoggedIn) {\n      await this.logout();\n    }\n    this.clearInit();\n  }\n\n  clearInit(): void {\n    function isElement(element: unknown) {\n      return element instanceof Element || element instanceof HTMLDocument;\n    }\n    if (isElement(this.styleLink) && window.document.body.contains(this.styleLink)) {\n      this.styleLink.remove();\n      this.styleLink = undefined;\n    }\n    if (isElement(this.torusIframe) && window.document.body.contains(this.torusIframe)) {\n      this.torusIframe.remove();\n      this.torusIframe = undefined;\n    }\n    if (isElement(this.torusAlertContainer) && window.document.body.contains(this.torusAlertContainer)) {\n      this.torusAlert = undefined;\n      this.torusAlertContainer.remove();\n      this.torusAlertContainer = undefined;\n    }\n    this.isInitialized = false;\n  }\n\n  hideTorusButton(): void {\n    this.torusWidgetVisibility = false;\n    this._sendWidgetVisibilityStatus(false);\n    this._displayIframe();\n  }\n\n  showTorusButton(): void {\n    this.torusWidgetVisibility = true;\n    this._sendWidgetVisibilityStatus(true);\n    this._displayIframe();\n  }\n\n  setProvider({ host = \"mainnet\", chainId = null, networkName = \"\", ...rest } = {}): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const providerChangeStream = this.communicationMux.getStream(\"provider_change\") as Substream;\n      const handler = (chunk) => {\n        const { err, success } = chunk.data;\n        log.info(chunk);\n        if (err) {\n          reject(err);\n        } else if (success) {\n          resolve();\n        } else reject(new Error(\"some error occured\"));\n      };\n      handleStream(providerChangeStream, \"data\", handler);\n      const preopenInstanceId = getPreopenInstanceId();\n      this._handleWindow(preopenInstanceId, {\n        target: \"_blank\",\n        features: FEATURES_PROVIDER_CHANGE_WINDOW,\n      });\n      providerChangeStream.write({\n        name: \"show_provider_change\",\n        data: {\n          network: {\n            host,\n            chainId,\n            networkName,\n            ...rest,\n          },\n          preopenInstanceId,\n          override: false,\n        },\n      });\n    });\n  }\n\n  showWallet(path: WALLET_PATH, params: Record<string, string> = {}): void {\n    const showWalletStream = this.communicationMux.getStream(\"show_wallet\") as Substream;\n    const finalPath = path ? `/${path}` : \"\";\n    showWalletStream.write({ name: \"show_wallet\", data: { path: finalPath } });\n\n    const showWalletHandler = (chunk) => {\n      if (chunk.name === \"show_wallet_instance\") {\n        // Let the error propogate up (hence, no try catch)\n        const { instanceId } = chunk.data;\n        const finalUrl = new URL(`${this.torusUrl}/wallet${finalPath}`);\n        // Using URL constructor to prevent js injection and allow parameter validation.!\n        finalUrl.searchParams.append(\"integrity\", \"true\");\n        finalUrl.searchParams.append(\"instanceId\", instanceId);\n        Object.keys(params).forEach((x) => {\n          finalUrl.searchParams.append(x, params[x]);\n        });\n        if (this.dappStorageKey) {\n          finalUrl.hash = `#dappStorageKey=${this.dappStorageKey}`;\n        }\n        const walletWindow = new PopupHandler({ url: finalUrl, features: FEATURES_DEFAULT_WALLET_WINDOW });\n        walletWindow.open();\n      }\n    };\n\n    handleStream(showWalletStream, \"data\", showWalletHandler);\n  }\n\n  async getPublicAddress({ verifier, verifierId, isExtended = false }: VerifierArgs): Promise<string | TorusPublicKey> {\n    if (!configuration.supportedVerifierList.includes(verifier) || !WALLET_OPENLOGIN_VERIFIER_MAP[verifier]) throw new Error(\"Unsupported verifier\");\n    const nodeDetails = await this.nodeDetailManager.getNodeDetails({ verifier, verifierId });\n    const endpoints = nodeDetails.torusNodeEndpoints;\n    const torusNodePubs = nodeDetails.torusNodePub;\n    const walletVerifier = verifier;\n    const openloginVerifier = WALLET_OPENLOGIN_VERIFIER_MAP[verifier];\n    try {\n      const existingV1User = await this.torusJs.getUserTypeAndAddress(endpoints, torusNodePubs, { verifier: walletVerifier, verifierId });\n      if (existingV1User.typeOfUser === \"v1\") {\n        if (!isExtended) return existingV1User.address;\n        return existingV1User;\n      }\n      // we don't support v2 users with v1 verifiers so get or assign the key for v2 user on v2 `verifier`\n      const v2User = await this.torusJs.getUserTypeAndAddress(endpoints, torusNodePubs, { verifier: openloginVerifier, verifierId }, true);\n      if (!isExtended) return v2User.address;\n      return v2User;\n    } catch (error) {\n      if (error?.message.includes(\"Verifier + VerifierID has not yet been assigned\")) {\n        // if user doesn't have key then assign it with v2 verifier\n        const newV2User = await this.torusJs.getUserTypeAndAddress(endpoints, torusNodePubs, { verifier: openloginVerifier, verifierId }, true);\n        if (!isExtended) return newV2User.address;\n        return newV2User;\n      }\n      throw error;\n    }\n  }\n\n  getUserInfo(message: string): Promise<UserInfo> {\n    return new Promise((resolve, reject) => {\n      if (this.isLoggedIn) {\n        const userInfoAccessStream = this.communicationMux.getStream(\"user_info_access\") as Substream;\n        userInfoAccessStream.write({ name: \"user_info_access_request\" });\n        const userInfoAccessHandler = (chunk) => {\n          const {\n            name,\n            data: { approved, payload, rejected, newRequest },\n          } = chunk;\n          if (name === \"user_info_access_response\") {\n            if (approved) {\n              resolve(payload);\n            } else if (rejected) {\n              reject(new Error(\"User rejected the request\"));\n            } else if (newRequest) {\n              const userInfoStream = this.communicationMux.getStream(\"user_info\") as Substream;\n              const userInfoHandler = (handlerChunk) => {\n                if (handlerChunk.name === \"user_info_response\") {\n                  if (handlerChunk.data.approved) {\n                    resolve(handlerChunk.data.payload);\n                  } else {\n                    reject(new Error(\"User rejected the request\"));\n                  }\n                }\n              };\n              handleStream(userInfoStream, \"data\", userInfoHandler);\n              const preopenInstanceId = getPreopenInstanceId();\n              this._handleWindow(preopenInstanceId, {\n                target: \"_blank\",\n                features: FEATURES_PROVIDER_CHANGE_WINDOW,\n              });\n              userInfoStream.write({ name: \"user_info_request\", data: { message, preopenInstanceId } });\n            }\n          }\n        };\n        handleStream(userInfoAccessStream, \"data\", userInfoAccessHandler);\n      } else reject(new Error(\"User has not logged in yet\"));\n    });\n  }\n\n  initiateTopup(provider: PAYMENT_PROVIDER_TYPE, params: PaymentParams): Promise<boolean> {\n    return new Promise((resolve, reject) => {\n      if (this.isInitialized) {\n        const { errors, isValid } = validatePaymentProvider(provider, params);\n        if (!isValid) {\n          reject(new Error(JSON.stringify(errors)));\n          return;\n        }\n        const topupStream = this.communicationMux.getStream(\"topup\") as Substream;\n        const topupHandler = (chunk) => {\n          if (chunk.name === \"topup_response\") {\n            if (chunk.data.success) {\n              resolve(chunk.data.success);\n            } else {\n              reject(new Error(chunk.data.error));\n            }\n          }\n        };\n        handleStream(topupStream, \"data\", topupHandler);\n        const preopenInstanceId = getPreopenInstanceId();\n        this._handleWindow(preopenInstanceId);\n        topupStream.write({ name: \"topup_request\", data: { provider, params, preopenInstanceId } });\n      } else reject(new Error(\"Torus is not initialized yet\"));\n    });\n  }\n\n  async loginWithPrivateKey(loginParams: { privateKey: string; userInfo: Omit<UserInfo, \"isNewUser\"> }): Promise<void> {\n    const { privateKey, userInfo } = loginParams;\n    return new Promise((resolve, reject) => {\n      if (this.isInitialized) {\n        if (Buffer.from(privateKey, \"hex\").length !== 32) {\n          reject(new Error(\"Invalid private key, Please provide a 32 byte valid secp25k1 private key\"));\n          return;\n        }\n        const loginPrivKeyStream = this.communicationMux.getStream(\"login_with_private_key\") as Substream;\n        const loginHandler = (chunk) => {\n          if (chunk.name === \"login_with_private_key_response\") {\n            if (chunk.data.success) {\n              resolve(chunk.data.success);\n            } else {\n              reject(new Error(chunk.data.error));\n            }\n          }\n        };\n        handleStream(loginPrivKeyStream, \"data\", loginHandler);\n        loginPrivKeyStream.write({ name: \"login_with_private_key_request\", data: { privateKey, userInfo } });\n      } else reject(new Error(\"Torus is not initialized yet\"));\n    });\n  }\n\n  async showWalletConnectScanner(): Promise<void> {\n    if (!this.useWalletConnect) throw new Error(\"Set `useWalletConnect` as true in init function options to use wallet connect scanner\");\n    return new Promise((resolve, reject) => {\n      if (this.isLoggedIn) {\n        const walletConnectStream = this.communicationMux.getStream(\"wallet_connect_stream\") as Substream;\n        const walletConnectHandler = (chunk) => {\n          if (chunk.name === \"wallet_connect_stream_res\") {\n            if (chunk.data.success) {\n              resolve(chunk.data.success);\n            } else {\n              reject(new Error(chunk.data.error));\n            }\n            this._displayIframe();\n          }\n        };\n        handleStream(walletConnectStream, \"data\", walletConnectHandler);\n        walletConnectStream.write({ name: \"wallet_connect_stream_req\" });\n        this._displayIframe(true);\n      } else reject(new Error(\"User has not logged in yet\"));\n    });\n  }\n\n  protected _handleWindow(preopenInstanceId: string, { url, target, features }: { url?: string; target?: string; features?: string } = {}): void {\n    if (preopenInstanceId) {\n      const windowStream = this.communicationMux.getStream(\"window\") as Substream;\n      const finalUrl = new URL(url || `${this.torusUrl}/redirect?preopenInstanceId=${preopenInstanceId}`);\n      if (this.dappStorageKey) {\n        // If multiple instances, it returns the first one\n        if (finalUrl.hash) finalUrl.hash += `&dappStorageKey=${this.dappStorageKey}`;\n        else finalUrl.hash = `#dappStorageKey=${this.dappStorageKey}`;\n      }\n      const handledWindow = new PopupHandler({ url: finalUrl, target, features });\n      handledWindow.open();\n      if (!handledWindow.window) {\n        this._createPopupBlockAlert(preopenInstanceId, finalUrl.href);\n        return;\n      }\n      windowStream.write({\n        name: \"opened_window\",\n        data: {\n          preopenInstanceId,\n        },\n      });\n      const closeHandler = ({ preopenInstanceId: receivedId, close }) => {\n        if (receivedId === preopenInstanceId && close) {\n          handledWindow.close();\n          windowStream.removeListener(\"data\", closeHandler);\n        }\n      };\n      windowStream.on(\"data\", closeHandler);\n      handledWindow.once(\"close\", () => {\n        windowStream.write({\n          data: {\n            preopenInstanceId,\n            closed: true,\n          },\n        });\n        windowStream.removeListener(\"data\", closeHandler);\n      });\n    }\n  }\n\n  protected _setEmbedWhiteLabel(element: HTMLElement): void {\n    // Set whitelabel\n    const { theme } = this.whiteLabel || {};\n    if (theme) {\n      const { isDark = false, colors = {} } = theme;\n      if (isDark) element.classList.add(\"torus-dark\");\n\n      if (colors.torusBrand1) element.style.setProperty(\"--torus-brand-1\", colors.torusBrand1);\n      if (colors.torusGray2) element.style.setProperty(\"--torus-gray-2\", colors.torusGray2);\n    }\n  }\n\n  protected _getLogoUrl(): string {\n    let logoUrl = `${this.torusUrl}/images/torus_icon-blue.svg`;\n    if (this.whiteLabel?.theme?.isDark) {\n      logoUrl = this.whiteLabel?.logoLight || logoUrl;\n    } else {\n      logoUrl = this.whiteLabel?.logoDark || logoUrl;\n    }\n\n    return logoUrl;\n  }\n\n  protected _sendWidgetVisibilityStatus(status: boolean): void {\n    const torusWidgetVisibilityStream = this.communicationMux.getStream(\"torus-widget-visibility\") as Substream;\n    torusWidgetVisibilityStream.write({\n      data: status,\n    });\n  }\n\n  protected _displayIframe(isFull = false): void {\n    const style: Partial<CSSStyleDeclaration> = {};\n    // set phase\n    if (!isFull) {\n      style.display = this.torusWidgetVisibility ? \"block\" : \"none\";\n      style.height = \"70px\";\n      style.width = \"70px\";\n      switch (this.buttonPosition) {\n        case BUTTON_POSITION.TOP_LEFT:\n          style.top = \"0px\";\n          style.left = \"0px\";\n          style.right = \"auto\";\n          style.bottom = \"auto\";\n          break;\n        case BUTTON_POSITION.TOP_RIGHT:\n          style.top = \"0px\";\n          style.right = \"0px\";\n          style.left = \"auto\";\n          style.bottom = \"auto\";\n          break;\n        case BUTTON_POSITION.BOTTOM_RIGHT:\n          style.bottom = \"0px\";\n          style.right = \"0px\";\n          style.top = \"auto\";\n          style.left = \"auto\";\n          break;\n        case BUTTON_POSITION.BOTTOM_LEFT:\n        default:\n          style.bottom = \"0px\";\n          style.left = \"0px\";\n          style.top = \"auto\";\n          style.right = \"auto\";\n          break;\n      }\n    } else {\n      style.display = \"block\";\n      style.width = \"100%\";\n      style.height = \"100%\";\n      style.top = \"0px\";\n      style.right = \"0px\";\n      style.left = \"0px\";\n      style.bottom = \"0px\";\n    }\n    Object.assign(this.torusIframe.style, style);\n    this.isIframeFullScreen = isFull;\n  }\n\n  protected _setupWeb3(): void {\n    log.info(\"setupWeb3 running\");\n    // setup background connection\n    const metamaskStream = new BasePostMessageStream({\n      name: \"embed_metamask\",\n      target: \"iframe_metamask\",\n      targetWindow: this.torusIframe.contentWindow,\n      targetOrigin: new URL(this.torusUrl).origin,\n    });\n\n    // Due to compatibility reasons, we should not set up multiplexing on window.metamaskstream\n    // because the MetamaskInpageProvider also attempts to do so.\n    // We create another LocalMessageDuplexStream for communication between dapp <> iframe\n    const communicationStream = new BasePostMessageStream({\n      name: \"embed_comm\",\n      target: \"iframe_comm\",\n      targetWindow: this.torusIframe.contentWindow,\n      targetOrigin: new URL(this.torusUrl).origin,\n    });\n\n    // Backward compatibility with Gotchi :)\n    // window.metamaskStream = this.communicationStream\n\n    // compose the inpage provider\n    const inpageProvider = new TorusInpageProvider(metamaskStream);\n\n    // detect eth_requestAccounts and pipe to enable for now\n    const detectAccountRequestPrototypeModifier = (m) => {\n      const originalMethod = inpageProvider[m];\n      inpageProvider[m] = function providerFunc(method, ...args) {\n        if (method && method === \"eth_requestAccounts\") {\n          return inpageProvider.enable();\n        }\n        return originalMethod.apply(this, [method, ...args]);\n      };\n    };\n\n    detectAccountRequestPrototypeModifier(\"send\");\n    detectAccountRequestPrototypeModifier(\"sendAsync\");\n\n    inpageProvider.enable = () => {\n      return new Promise((resolve, reject) => {\n        // If user is already logged in, we assume they have given access to the website\n        inpageProvider.sendAsync({ jsonrpc: \"2.0\", id: getPreopenInstanceId(), method: \"eth_requestAccounts\", params: [] }, (err, response) => {\n          const { result: res } = (response as { result: unknown }) || {};\n          if (err) {\n            setTimeout(() => {\n              reject(err);\n            }, 50);\n          } else if (Array.isArray(res) && res.length > 0) {\n            // If user is already rehydrated, resolve this\n            // else wait for something to be written to status stream\n            const handleLoginCb = () => {\n              if (this.requestedVerifier !== \"\" && this.currentVerifier !== this.requestedVerifier) {\n                const { requestedVerifier } = this;\n                // eslint-disable-next-line promise/no-promise-in-callback\n                this.logout()\n                  // eslint-disable-next-line promise/always-return\n                  .then((_) => {\n                    this.requestedVerifier = requestedVerifier;\n                    this._showLoginPopup(true, resolve, reject);\n                  })\n                  .catch((error) => reject(error));\n              } else {\n                resolve(res);\n              }\n            };\n            if (this.isLoggedIn) {\n              handleLoginCb();\n            } else {\n              this.isLoginCallback = handleLoginCb;\n            }\n          } else {\n            // set up listener for login\n            this._showLoginPopup(true, resolve, reject);\n          }\n        });\n      });\n    };\n\n    inpageProvider.tryPreopenHandle = (payload: UnvalidatedJsonRpcRequest | UnvalidatedJsonRpcRequest[], cb: (...args: unknown[]) => void) => {\n      const _payload = payload;\n      if (!Array.isArray(_payload) && UNSAFE_METHODS.includes(_payload.method)) {\n        const preopenInstanceId = getPreopenInstanceId();\n        this._handleWindow(preopenInstanceId, {\n          target: \"_blank\",\n          features: FEATURES_CONFIRM_WINDOW,\n        });\n        _payload.preopenInstanceId = preopenInstanceId;\n      }\n      inpageProvider._rpcEngine.handle(_payload as JRPCRequest<unknown>[], cb);\n    };\n\n    // Work around for web3@1.0 deleting the bound `sendAsync` but not the unbound\n    // `sendAsync` method on the prototype, causing `this` reference issues with drizzle\n    const proxiedInpageProvider = new Proxy(inpageProvider, {\n      // straight up lie that we deleted the property so that it doesnt\n      // throw an error in strict mode\n      deleteProperty: () => true,\n    });\n\n    this.ethereum = proxiedInpageProvider;\n    const communicationMux = setupMultiplex(communicationStream);\n\n    this.communicationMux = communicationMux;\n\n    const windowStream = communicationMux.getStream(\"window\") as Substream;\n    windowStream.on(\"data\", (chunk) => {\n      if (chunk.name === \"create_window\") {\n        // url is the url we need to open\n        // we can pass the final url upfront so that it removes the step of redirecting to /redirect and waiting for finalUrl\n        this._createPopupBlockAlert(chunk.data.preopenInstanceId, chunk.data.url);\n      }\n    });\n\n    // show torus widget if button clicked\n    const widgetStream = communicationMux.getStream(\"widget\") as Substream;\n    widgetStream.on(\"data\", (chunk) => {\n      const { data } = chunk;\n      this._displayIframe(data);\n    });\n\n    // Show torus button if wallet has been hydrated/detected\n    const statusStream = communicationMux.getStream(\"status\") as Substream;\n    statusStream.on(\"data\", (status) => {\n      // login\n      if (status.loggedIn) {\n        this.isLoggedIn = status.loggedIn;\n        this.currentVerifier = status.verifier;\n      } // logout\n      else this._displayIframe();\n      if (this.isLoginCallback) {\n        this.isLoginCallback();\n        delete this.isLoginCallback;\n      }\n    });\n\n    this.provider = proxiedInpageProvider;\n\n    if (this.provider.shouldSendMetadata) sendSiteMetadata(this.provider._rpcEngine);\n    inpageProvider._initializeState();\n    log.debug(\"Torus - injected provider\");\n  }\n\n  protected _showLoginPopup(calledFromEmbed: boolean, resolve: (a: string[]) => void, reject: (err: Error) => void): void {\n    const loginHandler = (data) => {\n      const { err, selectedAddress } = data;\n      if (err) {\n        log.error(err);\n        if (reject) reject(err);\n      }\n      // returns an array (cause accounts expects it)\n      else if (resolve) resolve([selectedAddress]);\n      if (this.isIframeFullScreen) this._displayIframe();\n    };\n    const oauthStream = this.communicationMux.getStream(\"oauth\") as Substream;\n    if (!this.requestedVerifier) {\n      this._displayIframe(true);\n      handleStream(oauthStream, \"data\", loginHandler);\n      oauthStream.write({ name: \"oauth_modal\", data: { calledFromEmbed } });\n    } else {\n      handleStream(oauthStream, \"data\", loginHandler);\n      const preopenInstanceId = getPreopenInstanceId();\n      this._handleWindow(preopenInstanceId);\n      oauthStream.write({\n        name: \"oauth\",\n        data: { calledFromEmbed, verifier: this.requestedVerifier, preopenInstanceId, login_hint: this.loginHint },\n      });\n    }\n  }\n\n  protected _createPopupBlockAlert(preopenInstanceId: string, url: string): void {\n    const logoUrl = this._getLogoUrl();\n    const torusAlert = htmlToElement<HTMLDivElement>(\n      '<div id=\"torusAlert\" class=\"torus-alert--v2\">' +\n        `<div id=\"torusAlert__logo\"><img src=\"${logoUrl}\" /></div>` +\n        \"<div>\" +\n        `<h1 id=\"torusAlert__title\">${this.embedTranslations.actionRequired}</h1>` +\n        `<p id=\"torusAlert__desc\">${this.embedTranslations.pendingAction}</p>` +\n        \"</div>\" +\n        \"</div>\"\n    );\n\n    const successAlert = htmlToElement(`<div><a id=\"torusAlert__btn\">${this.embedTranslations.continue}</a></div>`);\n    const btnContainer = htmlToElement('<div id=\"torusAlert__btn-container\"></div>');\n    btnContainer.appendChild(successAlert);\n    torusAlert.appendChild(btnContainer);\n    const bindOnLoad = () => {\n      successAlert.addEventListener(\"click\", () => {\n        this._handleWindow(preopenInstanceId, {\n          url,\n          target: \"_blank\",\n          features: FEATURES_CONFIRM_WINDOW,\n        });\n        torusAlert.remove();\n\n        if (this.torusAlertContainer.children.length === 0) this.torusAlertContainer.style.display = \"none\";\n      });\n    };\n\n    this._setEmbedWhiteLabel(torusAlert);\n\n    const attachOnLoad = () => {\n      this.torusAlertContainer.style.display = \"block\";\n      this.torusAlertContainer.appendChild(torusAlert);\n    };\n\n    runOnLoad(attachOnLoad);\n    runOnLoad(bindOnLoad);\n  }\n}\n\nexport default Torus;\n","export { default } from \"./embed\";\nexport { default as TorusInpageProvider } from \"./inpage-provider\";\nexport * from \"./interfaces\";\n"],"sourceRoot":""}