{"version":3,"file":"openloginJrpc.esm.js","sources":["../src/basePostMessageStream.ts","../src/safeEventEmitter.ts","../src/serializableError.ts","../src/jrpc.ts","../src/jrpcEngine.ts","../src/substream.ts","../src/mux.ts","../src/postMessageStream.ts"],"sourcesContent":[null,null,null,null,null,null,null,null],"names":["noop","undefined","SYN","ACK","BRK","BasePostMessageStream","Duplex","constructor","name","target","targetWindow","window","targetOrigin","objectMode","Error","_init","_haveSyn","_name","_target","_targetWindow","_targetOrigin","_onMessage","onMessage","bind","_synIntervalId","addEventListener","_handShake","_break","cork","_write","_onData","data","uncork","push","err","emit","_postMessage","originConstraint","postMessage","event","message","origin","source","_read","_","cb","_destroy","removeEventListener","safeApply","handler","context","args","Reflect","apply","setTimeout","arrayClone","arr","n","length","copy","Array","i","SafeEventEmitter","EventEmitter","type","doError","events","_events","error","er","len","listeners","SerializableError","code","Number","isInteger","toString","stringify","stack","serializeError","getRpcPromiseCallback","resolve","reject","unwrapResult","response","isArray","result","createErrorMiddleware","log","req","res","next","end","method","done","createStreamMiddleware","idMap","readNoop","processResponse","id","Object","assign","processNotification","processMessage","_encoding","isNotification","_err","stream","read","write","middleware","createScaffoldMiddleware","handlers","createIdRemapMiddleware","_end","originalId","newId","randomId","createLoggerMiddleware","logger","debug","createAsyncMiddleware","asyncMiddleware","resolveNextPromise","nextPromise","Promise","returnHandlerCallback","nextWasCalled","asyncNext","runReturnHandlersCallback","JRPCEngine","_middleware","_runAllMiddleware","middlewareStack","returnHandlers","isComplete","_runMiddleware","reverse","returnHandler","_runReturnHandlers","_checkForCompletion","handle","_handleBatch","_handle","_promiseHandle","asMiddleware","middlewareError","handlerCallback","reqs","responses","all","map","callerReq","jsonrpc","_processRequest","_error","mergeMiddleware","engine","forEach","createEngineStream","opts","on","Substream","parent","_parent","chunk","callback","IGNORE_SUBSTREAM","Symbol","ObjectMultiplex","_substreams","createStream","substream","anyStreamEnd","destroy","ignoreStream","console","warn","_cb","once","eos","readable","writable","setupMultiplex","mux","getStream","streamHelper","pump","PostMessageStream","dataObj","dataObjData","params","dataObjDataParam","_origin","location"],"mappings":"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"}