{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.addStorageEventListener = addStorageEventListener;\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.close = close;\nexports.create = create;\nexports[\"default\"] = void 0;\nexports.getLocalStorage = getLocalStorage;\nexports.microSeconds = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.removeStorageEventListener = removeStorageEventListener;\nexports.storageKey = storageKey;\nexports.type = void 0;\nvar _obliviousSet = require(\"oblivious-set\");\nvar _options = require(\"../options\");\nvar _util = require(\"../util\");\n\n/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\nvar microSeconds = _util.microSeconds;\nexports.microSeconds = microSeconds;\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nvar type = 'localstorage';\n/**\n * copied from crosstab\n * @link https://github.com/tejacques/crosstab/blob/master/src/crosstab.js#L32\n */\n\nexports.type = type;\nfunction getLocalStorage() {\n  var localStorage;\n  if (typeof window === 'undefined') return null;\n  try {\n    localStorage = window.localStorage;\n    localStorage = window['ie8-eventlistener/storage'] || window.localStorage;\n  } catch (e) {// New versions of Firefox throw a Security exception\n    // if cookies are disabled. See\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1028153\n  }\n  return localStorage;\n}\nfunction storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n/**\n* writes the new message to the storage\n* and fires the storage-event so other readers can find it\n*/\n\nfunction postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    (0, _util.sleep)().then(function () {\n      var key = storageKey(channelState.channelName);\n      var writeObj = {\n        token: (0, _util.randomToken)(),\n        time: new Date().getTime(),\n        data: messageJson,\n        uuid: channelState.uuid\n      };\n      var value = JSON.stringify(writeObj);\n      getLocalStorage().setItem(key, value);\n      /**\n       * StorageEvent does not fire the 'storage' event\n       * in the window that changes the state of the local storage.\n       * So we fire it manually\n       */\n\n      var ev = document.createEvent('Event');\n      ev.initEvent('storage', true, true);\n      ev.key = key;\n      ev.newValue = value;\n      window.dispatchEvent(ev);\n      res();\n    });\n  });\n}\nfunction addStorageEventListener(channelName, fn) {\n  var key = storageKey(channelName);\n  var listener = function listener(ev) {\n    if (ev.key === key) {\n      fn(JSON.parse(ev.newValue));\n    }\n  };\n  window.addEventListener('storage', listener);\n  return listener;\n}\nfunction removeStorageEventListener(listener) {\n  window.removeEventListener('storage', listener);\n}\nfunction create(channelName, options) {\n  options = (0, _options.fillOptionsWithDefaults)(options);\n  if (!canBeUsed()) {\n    throw new Error('BroadcastChannel: localstorage cannot be used');\n  }\n  var uuid = (0, _util.randomToken)();\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n\n  var eMIs = new _obliviousSet.ObliviousSet(options.localstorage.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs // emittedMessagesIds\n  };\n\n  state.listener = addStorageEventListener(channelName, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n\n    if (msgObj.uuid === uuid) return; // own message\n\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n\n    if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\nfunction close(channelState) {\n  removeStorageEventListener(channelState.listener);\n}\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\nfunction canBeUsed() {\n  if (_util.isNode) return false;\n  var ls = getLocalStorage();\n  if (!ls) return false;\n  try {\n    var key = '__broadcastchannel_check';\n    ls.setItem(key, 'works');\n    ls.removeItem(key);\n  } catch (e) {\n    // Safari 10 in private mode will not allow write access to local\n    // storage and fail with a QuotaExceededError. See\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API#Private_Browsing_Incognito_modes\n    return false;\n  }\n  return true;\n}\nfunction averageResponseTime() {\n  var defaultTime = 120;\n  var userAgent = navigator.userAgent.toLowerCase();\n  if (userAgent.includes('safari') && !userAgent.includes('chrome')) {\n    // safari is much slower so this time is higher\n    return defaultTime * 2;\n  }\n  return defaultTime;\n}\nvar _default = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports[\"default\"] = _default;","map":{"version":3,"names":["Object","defineProperty","exports","value","addStorageEventListener","averageResponseTime","canBeUsed","close","create","getLocalStorage","microSeconds","onMessage","postMessage","removeStorageEventListener","storageKey","type","_obliviousSet","require","_options","_util","KEY_PREFIX","localStorage","window","e","channelName","channelState","messageJson","Promise","res","sleep","then","key","writeObj","token","randomToken","time","Date","getTime","data","uuid","JSON","stringify","setItem","ev","document","createEvent","initEvent","newValue","dispatchEvent","fn","listener","parse","addEventListener","removeEventListener","options","fillOptionsWithDefaults","Error","eMIs","ObliviousSet","localstorage","removeTimeout","state","msgObj","messagesCallback","has","messagesCallbackTime","add","isNode","ls","removeItem","defaultTime","userAgent","navigator","toLowerCase","includes","_default"],"sources":["/Users/shivamsoni/Desktop/router/pingspong/Ping-Pong/node_modules/broadcast-channel/dist/lib/methods/localstorage.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.addStorageEventListener = addStorageEventListener;\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.close = close;\nexports.create = create;\nexports[\"default\"] = void 0;\nexports.getLocalStorage = getLocalStorage;\nexports.microSeconds = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.removeStorageEventListener = removeStorageEventListener;\nexports.storageKey = storageKey;\nexports.type = void 0;\n\nvar _obliviousSet = require(\"oblivious-set\");\n\nvar _options = require(\"../options\");\n\nvar _util = require(\"../util\");\n\n/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\nvar microSeconds = _util.microSeconds;\nexports.microSeconds = microSeconds;\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nvar type = 'localstorage';\n/**\n * copied from crosstab\n * @link https://github.com/tejacques/crosstab/blob/master/src/crosstab.js#L32\n */\n\nexports.type = type;\n\nfunction getLocalStorage() {\n  var localStorage;\n  if (typeof window === 'undefined') return null;\n\n  try {\n    localStorage = window.localStorage;\n    localStorage = window['ie8-eventlistener/storage'] || window.localStorage;\n  } catch (e) {// New versions of Firefox throw a Security exception\n    // if cookies are disabled. See\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1028153\n  }\n\n  return localStorage;\n}\n\nfunction storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n/**\n* writes the new message to the storage\n* and fires the storage-event so other readers can find it\n*/\n\n\nfunction postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    (0, _util.sleep)().then(function () {\n      var key = storageKey(channelState.channelName);\n      var writeObj = {\n        token: (0, _util.randomToken)(),\n        time: new Date().getTime(),\n        data: messageJson,\n        uuid: channelState.uuid\n      };\n      var value = JSON.stringify(writeObj);\n      getLocalStorage().setItem(key, value);\n      /**\n       * StorageEvent does not fire the 'storage' event\n       * in the window that changes the state of the local storage.\n       * So we fire it manually\n       */\n\n      var ev = document.createEvent('Event');\n      ev.initEvent('storage', true, true);\n      ev.key = key;\n      ev.newValue = value;\n      window.dispatchEvent(ev);\n      res();\n    });\n  });\n}\n\nfunction addStorageEventListener(channelName, fn) {\n  var key = storageKey(channelName);\n\n  var listener = function listener(ev) {\n    if (ev.key === key) {\n      fn(JSON.parse(ev.newValue));\n    }\n  };\n\n  window.addEventListener('storage', listener);\n  return listener;\n}\n\nfunction removeStorageEventListener(listener) {\n  window.removeEventListener('storage', listener);\n}\n\nfunction create(channelName, options) {\n  options = (0, _options.fillOptionsWithDefaults)(options);\n\n  if (!canBeUsed()) {\n    throw new Error('BroadcastChannel: localstorage cannot be used');\n  }\n\n  var uuid = (0, _util.randomToken)();\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n\n  var eMIs = new _obliviousSet.ObliviousSet(options.localstorage.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs // emittedMessagesIds\n\n  };\n  state.listener = addStorageEventListener(channelName, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n\n    if (msgObj.uuid === uuid) return; // own message\n\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n\n    if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\n\nfunction close(channelState) {\n  removeStorageEventListener(channelState.listener);\n}\n\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\n\nfunction canBeUsed() {\n  if (_util.isNode) return false;\n  var ls = getLocalStorage();\n  if (!ls) return false;\n\n  try {\n    var key = '__broadcastchannel_check';\n    ls.setItem(key, 'works');\n    ls.removeItem(key);\n  } catch (e) {\n    // Safari 10 in private mode will not allow write access to local\n    // storage and fail with a QuotaExceededError. See\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API#Private_Browsing_Incognito_modes\n    return false;\n  }\n\n  return true;\n}\n\nfunction averageResponseTime() {\n  var defaultTime = 120;\n  var userAgent = navigator.userAgent.toLowerCase();\n\n  if (userAgent.includes('safari') && !userAgent.includes('chrome')) {\n    // safari is much slower so this time is higher\n    return defaultTime * 2;\n  }\n\n  return defaultTime;\n}\n\nvar _default = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports[\"default\"] = _default;"],"mappings":"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"},"metadata":{},"sourceType":"script"}