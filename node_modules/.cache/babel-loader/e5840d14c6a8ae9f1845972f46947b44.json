{"ast":null,"code":"import _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { SafeEventEmitter } from '@toruslabs/openlogin-jrpc';\nimport { ADAPTER_STATUS, CHAIN_NAMESPACES, WalletInitializationError, storageAvailable, getChainConfig, ADAPTER_NAMESPACES, WalletLoginError, ADAPTER_EVENTS } from '@web3auth/base';\nimport log from 'loglevel';\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nconst ADAPTER_CACHE_KEY = \"Web3Auth-cachedAdapter\";\nclass Web3AuthCore extends SafeEventEmitter {\n  constructor(options) {\n    var _options$chainConfig, _options$chainConfig2, _options$chainConfig3, _options$chainConfig4;\n    super();\n    _defineProperty(this, \"coreOptions\", void 0);\n    _defineProperty(this, \"connectedAdapterName\", null);\n    _defineProperty(this, \"status\", ADAPTER_STATUS.NOT_READY);\n    _defineProperty(this, \"cachedAdapter\", null);\n    _defineProperty(this, \"walletAdapters\", {});\n    if (!((_options$chainConfig = options.chainConfig) !== null && _options$chainConfig !== void 0 && _options$chainConfig.chainNamespace) || !Object.values(CHAIN_NAMESPACES).includes((_options$chainConfig2 = options.chainConfig) === null || _options$chainConfig2 === void 0 ? void 0 : _options$chainConfig2.chainNamespace)) throw WalletInitializationError.invalidParams(\"Please provide a valid chainNamespace in chainConfig\");\n    this.cachedAdapter = storageAvailable(\"sessionStorage\") ? window.sessionStorage.getItem(ADAPTER_CACHE_KEY) : null;\n    this.coreOptions = _objectSpread(_objectSpread({}, options), {}, {\n      chainConfig: _objectSpread(_objectSpread({}, getChainConfig((_options$chainConfig3 = options.chainConfig) === null || _options$chainConfig3 === void 0 ? void 0 : _options$chainConfig3.chainNamespace, (_options$chainConfig4 = options.chainConfig) === null || _options$chainConfig4 === void 0 ? void 0 : _options$chainConfig4.chainId)), options.chainConfig)\n    });\n    this.subscribeToAdapterEvents = this.subscribeToAdapterEvents.bind(this);\n  }\n  get provider() {\n    if (this.status === ADAPTER_STATUS.CONNECTED && this.connectedAdapterName) {\n      const adapter = this.walletAdapters[this.connectedAdapterName];\n      return adapter.provider;\n    }\n    return null;\n  }\n  set provider(_) {\n    throw new Error(\"Not implemented\");\n  }\n  async init() {\n    const initPromises = Object.keys(this.walletAdapters).map(adapterName => {\n      this.subscribeToAdapterEvents(this.walletAdapters[adapterName]); // if adapter doesn't have any chain config yet thn set it based on provided namespace and chainId.\n      // if no chainNamespace or chainId is being provided, it will connect with mainnet.\n\n      if (!this.walletAdapters[adapterName].chainConfigProxy) {\n        const providedChainConfig = this.coreOptions.chainConfig;\n        if (!providedChainConfig.chainNamespace) throw WalletInitializationError.invalidParams(\"Please provide chainNamespace in chainConfig\");\n        const chainConfig = _objectSpread(_objectSpread({}, getChainConfig(providedChainConfig.chainNamespace, providedChainConfig.chainId)), providedChainConfig);\n        this.walletAdapters[adapterName].setChainConfig(chainConfig);\n      }\n      return this.walletAdapters[adapterName].init({\n        autoConnect: this.cachedAdapter === adapterName\n      }).catch(e => log.error(e));\n    });\n    this.status = ADAPTER_STATUS.READY;\n    await Promise.all(initPromises);\n  }\n  configureAdapter(adapter) {\n    this.checkInitRequirements();\n    const providedChainConfig = this.coreOptions.chainConfig;\n    if (!providedChainConfig.chainNamespace) throw WalletInitializationError.invalidParams(\"Please provide chainNamespace in chainConfig\");\n    const adapterAlreadyExists = this.walletAdapters[adapter.name];\n    if (adapterAlreadyExists) throw WalletInitializationError.duplicateAdapterError(\"Wallet adapter for \".concat(adapter.name, \" already exists\"));\n    if (adapter.adapterNamespace !== ADAPTER_NAMESPACES.MULTICHAIN && adapter.adapterNamespace !== providedChainConfig.chainNamespace) throw WalletInitializationError.incompatibleChainNameSpace(\"This wallet adapter belongs to \".concat(adapter.adapterNamespace, \" which is incompatible with currently used namespace: \").concat(providedChainConfig.chainNamespace));\n    if (adapter.adapterNamespace === ADAPTER_NAMESPACES.MULTICHAIN && adapter.currentChainNamespace && providedChainConfig.chainNamespace !== adapter.currentChainNamespace) {\n      // chainConfig checks are already validated in constructor so using typecast is safe here.\n      adapter.setChainConfig(providedChainConfig);\n    }\n    this.walletAdapters[adapter.name] = adapter;\n    return this;\n  }\n  clearCache() {\n    if (!storageAvailable(\"sessionStorage\")) return;\n    window.sessionStorage.removeItem(ADAPTER_CACHE_KEY);\n    this.cachedAdapter = null;\n  }\n  /**\n   * Connect to a specific wallet adapter\n   * @param walletName - Key of the walletAdapter to use.\n   */\n\n  async connectTo(walletName, loginParams) {\n    if (!this.walletAdapters[walletName]) throw WalletInitializationError.notFound(\"Please add wallet adapter for \".concat(walletName, \" wallet, before connecting\"));\n    return this.walletAdapters[walletName].connect(loginParams);\n  }\n  async logout() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n      cleanup: false\n    };\n    if (this.status !== ADAPTER_STATUS.CONNECTED || !this.connectedAdapterName) throw WalletLoginError.notConnectedError(\"No wallet is connected\");\n    await this.walletAdapters[this.connectedAdapterName].disconnect(options);\n  }\n  async getUserInfo() {\n    log.debug(\"Getting user info\", this.status, this.connectedAdapterName);\n    if (this.status !== ADAPTER_STATUS.CONNECTED || !this.connectedAdapterName) throw WalletLoginError.notConnectedError(\"No wallet is connected\");\n    return this.walletAdapters[this.connectedAdapterName].getUserInfo();\n  }\n  subscribeToAdapterEvents(walletAdapter) {\n    walletAdapter.on(ADAPTER_EVENTS.CONNECTED, data => {\n      this.status = ADAPTER_STATUS.CONNECTED;\n      this.connectedAdapterName = data.adapter;\n      this.cacheWallet(data.adapter);\n      this.emit(ADAPTER_EVENTS.CONNECTED, _objectSpread({}, data));\n      log.debug(\"connected\", this.status, this.connectedAdapterName);\n    });\n    walletAdapter.on(ADAPTER_EVENTS.DISCONNECTED, data => {\n      // get back to ready state for rehydrating.\n      this.status = ADAPTER_STATUS.READY;\n      this.emit(ADAPTER_EVENTS.DISCONNECTED, data);\n      if (storageAvailable(\"sessionStorage\")) {\n        const cachedAdapter = window.sessionStorage.getItem(ADAPTER_CACHE_KEY);\n        if (this.connectedAdapterName === cachedAdapter) {\n          this.clearCache();\n        }\n      }\n      log.debug(\"disconnected\", this.status, this.connectedAdapterName);\n    });\n    walletAdapter.on(ADAPTER_EVENTS.CONNECTING, data => {\n      this.status = ADAPTER_STATUS.CONNECTING;\n      this.emit(ADAPTER_EVENTS.CONNECTING, data);\n      log.debug(\"connecting\", this.status, this.connectedAdapterName);\n    });\n    walletAdapter.on(ADAPTER_EVENTS.ERRORED, data => {\n      this.status = ADAPTER_STATUS.ERRORED;\n      this.clearCache();\n      this.emit(ADAPTER_EVENTS.ERRORED, data);\n      log.debug(\"errored\", this.status, this.connectedAdapterName);\n    });\n    walletAdapter.on(ADAPTER_EVENTS.ADAPTER_DATA_UPDATED, data => {\n      log.debug(\"adapter data updated\", data);\n      this.emit(ADAPTER_EVENTS.ADAPTER_DATA_UPDATED, data);\n    });\n  }\n  checkInitRequirements() {\n    if (this.status === ADAPTER_STATUS.CONNECTING) throw WalletInitializationError.notReady(\"Already pending connection\");\n    if (this.status === ADAPTER_STATUS.CONNECTED) throw WalletInitializationError.notReady(\"Already connected\");\n    if (this.status === ADAPTER_STATUS.READY) throw WalletInitializationError.notReady(\"Adapter is already initialized\");\n  }\n  cacheWallet(walletName) {\n    if (!storageAvailable(\"sessionStorage\")) return;\n    window.sessionStorage.setItem(ADAPTER_CACHE_KEY, walletName);\n    this.cachedAdapter = walletName;\n  }\n}\nexport { Web3AuthCore };","map":{"version":3,"mappings":"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","names":["ADAPTER_CACHE_KEY","Web3AuthCore","SafeEventEmitter","constructor","options","ADAPTER_STATUS","NOT_READY","chainConfig","_options$chainConfig","chainNamespace","Object","values","CHAIN_NAMESPACES","includes","_options$chainConfig2","WalletInitializationError","invalidParams","cachedAdapter","storageAvailable","window","sessionStorage","getItem","coreOptions","getChainConfig","_options$chainConfig3","_options$chainConfig4","chainId","subscribeToAdapterEvents","bind","provider","status","CONNECTED","connectedAdapterName","adapter","walletAdapters","_","Error","init","initPromises","keys","map","adapterName","chainConfigProxy","providedChainConfig","setChainConfig","autoConnect","catch","e","log","error","READY","Promise","all","configureAdapter","checkInitRequirements","adapterAlreadyExists","name","duplicateAdapterError","adapterNamespace","ADAPTER_NAMESPACES","MULTICHAIN","incompatibleChainNameSpace","currentChainNamespace","clearCache","removeItem","connectTo","walletName","loginParams","notFound","connect","logout","cleanup","WalletLoginError","notConnectedError","disconnect","getUserInfo","debug","walletAdapter","on","ADAPTER_EVENTS","data","cacheWallet","emit","DISCONNECTED","CONNECTING","ERRORED","ADAPTER_DATA_UPDATED","notReady","setItem"],"sources":["../src/core.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}