{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst events_1 = require(\"events\");\nfunction safeApply(handler, context, args) {\n  try {\n    Reflect.apply(handler, context, args);\n  } catch (err) {\n    // Throw error after timeout so as not to interrupt the stack\n    setTimeout(() => {\n      throw err;\n    });\n  }\n}\nfunction arrayClone(arr) {\n  const n = arr.length;\n  const copy = new Array(n);\n  for (let i = 0; i < n; i += 1) {\n    copy[i] = arr[i];\n  }\n  return copy;\n}\nclass SafeEventEmitter extends events_1.EventEmitter {\n  emit(type) {\n    let doError = type === 'error';\n    const events = this._events;\n    if (events !== undefined) {\n      doError = doError && events.error === undefined;\n    } else if (!doError) {\n      return false;\n    }\n    // If there is no 'error' event listener then throw.\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    if (doError) {\n      let er;\n      if (args.length > 0) {\n        [er] = args;\n      }\n      if (er instanceof Error) {\n        // Note: The comments on the `throw` lines are intentional, they show\n        // up in Node's output if this results in an unhandled exception.\n        throw er; // Unhandled 'error' event\n      }\n      // At least give some kind of context to the user\n      const err = new Error(`Unhandled error.${er ? ` (${er.message})` : ''}`);\n      err.context = er;\n      throw err; // Unhandled 'error' event\n    }\n\n    const handler = events[type];\n    if (handler === undefined) {\n      return false;\n    }\n    if (typeof handler === 'function') {\n      safeApply(handler, this, args);\n    } else {\n      const len = handler.length;\n      const listeners = arrayClone(handler);\n      for (let i = 0; i < len; i += 1) {\n        safeApply(listeners[i], this, args);\n      }\n    }\n    return true;\n  }\n}\nexports.default = SafeEventEmitter;","map":{"version":3,"mappings":";;;;;AAAA;AAOA,SAASA,SAAS,CAAsBC,OAAsC,EAAEC,OAAU,EAAEC,IAAO;EACjG,IAAI;IACFC,OAAO,CAACC,KAAK,CAACJ,OAAO,EAAEC,OAAO,EAAEC,IAAI,CAAC;GACtC,CAAC,OAAOG,GAAG,EAAE;IACZ;IACAC,UAAU,CAAC,MAAK;MACd,MAAMD,GAAG;IACX,CAAC,CAAC;;AAEN;AAEA,SAASE,UAAU,CAAKC,GAAQ;EAC9B,MAAMC,CAAC,GAAGD,GAAG,CAACE,MAAM;EACpB,MAAMC,IAAI,GAAG,IAAIC,KAAK,CAACH,CAAC,CAAC;EACzB,KAAK,IAAII,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGJ,CAAC,EAAEI,CAAC,IAAI,CAAC,EAAE;IAC7BF,IAAI,CAACE,CAAC,CAAC,GAAGL,GAAG,CAACK,CAAC,CAAC;;EAElB,OAAOF,IAAI;AACb;AAEA,MAAqBG,gBAAiB,SAAQC,qBAAY;EACxDC,IAAI,CAAEC,IAAY,EAAgB;IAChC,IAAIC,OAAO,GAAGD,IAAI,KAAK,OAAO;IAE9B,MAAME,MAAM,GAAc,IAAY,CAACC,OAAO;IAC9C,IAAID,MAAM,KAAKE,SAAS,EAAE;MACxBH,OAAO,GAAGA,OAAO,IAAIC,MAAM,CAACG,KAAK,KAAKD,SAAS;KAChD,MAAM,IAAI,CAACH,OAAO,EAAE;MACnB,OAAO,KAAK;;IAGd;IAAA,kCAVqBhB,IAAW;MAAXA,IAAW;IAAA;IAWhC,IAAIgB,OAAO,EAAE;MACX,IAAIK,EAAE;MACN,IAAIrB,IAAI,CAACQ,MAAM,GAAG,CAAC,EAAE;QACnB,CAACa,EAAE,CAAC,GAAGrB,IAAI;;MAEb,IAAIqB,EAAE,YAAYC,KAAK,EAAE;QACvB;QACA;QACA,MAAMD,EAAE,CAAC,CAAC;;MAEZ;MACA,MAAMlB,GAAG,GAAG,IAAImB,KAAK,CAAC,mBAAmBD,EAAE,GAAG,KAAKA,EAAE,CAACE,OAAO,GAAG,GAAG,EAAE,EAAE,CAAC;MACvEpB,GAAW,CAACJ,OAAO,GAAGsB,EAAE;MACzB,MAAMlB,GAAG,CAAC,CAAC;;;IAGb,MAAML,OAAO,GAAGmB,MAAM,CAACF,IAAI,CAAC;IAE5B,IAAIjB,OAAO,KAAKqB,SAAS,EAAE;MACzB,OAAO,KAAK;;IAGd,IAAI,OAAOrB,OAAO,KAAK,UAAU,EAAE;MACjCD,SAAS,CAACC,OAAO,EAAE,IAAI,EAAEE,IAAI,CAAC;KAC/B,MAAM;MACL,MAAMwB,GAAG,GAAG1B,OAAO,CAACU,MAAM;MAC1B,MAAMiB,SAAS,GAAGpB,UAAU,CAACP,OAAO,CAAC;MACrC,KAAK,IAAIa,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGa,GAAG,EAAEb,CAAC,IAAI,CAAC,EAAE;QAC/Bd,SAAS,CAAC4B,SAAS,CAACd,CAAC,CAAC,EAAE,IAAI,EAAEX,IAAI,CAAC;;;IAIvC,OAAO,IAAI;EACb;;AA7CF0B","names":["safeApply","handler","context","args","Reflect","apply","err","setTimeout","arrayClone","arr","n","length","copy","Array","i","SafeEventEmitter","events_1","emit","type","doError","events","_events","undefined","error","er","Error","message","len","listeners","exports"],"sourceRoot":"","sources":["index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}